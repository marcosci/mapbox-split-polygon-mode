import Us from"https://unpkg.com/@mapbox/mapbox-gl-draw@1.3.0/src/lib/theme.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function r(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(a){if(a.ep)return;a.ep=!0;const s=r(a);fetch(a.href,s)}})();var Ue=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function co(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Fn(n){if(n.__esModule)return n;var t=n.default;if(typeof t=="function"){var r=function i(){return this instanceof i?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(n).forEach(function(i){var a=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(r,i,a.get?a:{enumerable:!0,get:function(){return n[i]}})}),r}var fo={exports:{}};(function(n,t){(function(r,i){n.exports=i()})(Ue,function(){var r=function(e,o){var u={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},d={on:function(m,x,N){if(u[m]===void 0)throw new Error("Invalid event type: "+m);u[m].push({selector:x,fn:N})},render:function(m){o.store.featureChanged(m)}},v=function(m,x){for(var N=u[m],A=N.length;A--;){var B=N[A];if(B.selector(x)){B.fn.call(d,x)||o.store.render(),o.ui.updateMapClasses();break}}};return e.start.call(d),{render:e.render,stop:function(){e.stop&&e.stop()},trash:function(){e.trash&&(e.trash(),o.store.render())},combineFeatures:function(){e.combineFeatures&&e.combineFeatures()},uncombineFeatures:function(){e.uncombineFeatures&&e.uncombineFeatures()},drag:function(m){v("drag",m)},click:function(m){v("click",m)},mousemove:function(m){v("mousemove",m)},mousedown:function(m){v("mousedown",m)},mouseup:function(m){v("mouseup",m)},mouseout:function(m){v("mouseout",m)},keydown:function(m){v("keydown",m)},keyup:function(m){v("keyup",m)},touchstart:function(m){v("touchstart",m)},touchmove:function(m){v("touchmove",m)},touchend:function(m){v("touchend",m)},tap:function(m){v("tap",m)}}};function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function a(e){if(e.__esModule)return e;var o=e.default;if(typeof o=="function"){var u=function d(){if(this instanceof d){var v=[null];v.push.apply(v,arguments);var m=Function.bind.apply(o,v);return new m}return o.apply(this,arguments)};u.prototype=o.prototype}else u={};return Object.defineProperty(u,"__esModule",{value:!0}),Object.keys(e).forEach(function(d){var v=Object.getOwnPropertyDescriptor(e,d);Object.defineProperty(u,d,v.get?v:{enumerable:!0,get:function(){return e[d]}})}),u}var s={},c={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:63567523142e-4},l=c;function f(e){var o=0;if(e&&e.length>0){o+=Math.abs(p(e[0]));for(var u=1;u<e.length;u++)o-=Math.abs(p(e[u]))}return o}function p(e){var o,u,d,v,m,x,N=0,A=e.length;if(A>2){for(x=0;x<A;x++)x===A-2?(d=A-2,v=A-1,m=0):x===A-1?(d=A-1,v=0,m=1):(d=x,v=x+1,m=x+2),o=e[d],u=e[v],N+=(w(e[m][0])-w(o[0]))*Math.sin(w(u[1]));N=N*l.RADIUS*l.RADIUS/2}return N}function w(e){return e*Math.PI/180}s.geometry=function e(o){var u,d=0;switch(o.type){case"Polygon":return f(o.coordinates);case"MultiPolygon":for(u=0;u<o.coordinates.length;u++)d+=f(o.coordinates[u]);return d;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(u=0;u<o.geometries.length;u++)d+=e(o.geometries[u]);return d}},s.ring=p;var h={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},g={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},E={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},C={POLYGON:"polygon",LINE:"line_string",POINT:"point"},_={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},I={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},O={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},y={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},b={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},M={ACTIVE:"true",INACTIVE:"false"},L=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],F=-85,R=Object.freeze({__proto__:null,classes:h,sources:g,cursors:E,types:C,geojsonTypes:_,modes:I,events:O,updateActions:y,meta:b,activeStates:M,interactions:L,LAT_MIN:-90,LAT_RENDERED_MIN:F,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),k={Point:0,LineString:1,MultiLineString:1,Polygon:2};function Y(e,o){var u=k[e.geometry.type]-k[o.geometry.type];return u===0&&e.geometry.type===_.POLYGON?e.area-o.area:u}function z(e){return e.map(function(o){return o.geometry.type===_.POLYGON&&(o.area=s.geometry({type:_.FEATURE,property:{},geometry:o.geometry})),o}).sort(Y).map(function(o){return delete o.area,o})}function j(e,o){return o===void 0&&(o=0),[[e.point.x-o,e.point.y-o],[e.point.x+o,e.point.y+o]]}function V(e){if(this._items={},this._nums={},this._length=e?e.length:0,e)for(var o=0,u=e.length;o<u;o++)this.add(e[o]),e[o]!==void 0&&(typeof e[o]=="string"?this._items[e[o]]=o:this._nums[e[o]]=o)}V.prototype.add=function(e){return this.has(e)||(this._length++,typeof e=="string"?this._items[e]=this._length:this._nums[e]=this._length),this},V.prototype.delete=function(e){return this.has(e)===!1||(this._length--,delete this._items[e],delete this._nums[e]),this},V.prototype.has=function(e){return(typeof e=="string"||typeof e=="number")&&(this._items[e]!==void 0||this._nums[e]!==void 0)},V.prototype.values=function(){var e=this,o=[];return Object.keys(this._items).forEach(function(u){o.push({k:u,v:e._items[u]})}),Object.keys(this._nums).forEach(function(u){o.push({k:JSON.parse(u),v:e._nums[u]})}),o.sort(function(u,d){return u.v-d.v}).map(function(u){return u.k})},V.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var J=[b.FEATURE,b.MIDPOINT,b.VERTEX],Z={click:function(e,o,u){return at(e,o,u,u.options.clickBuffer)},touch:function(e,o,u){return at(e,o,u,u.options.touchBuffer)}};function at(e,o,u,d){if(u.map===null)return[];var v=e?j(e,d):o,m={};u.options.styles&&(m.layers=u.options.styles.map(function(B){return B.id}).filter(function(B){return u.map.getLayer(B)!=null}));var x=u.map.queryRenderedFeatures(v,m).filter(function(B){return J.indexOf(B.properties.meta)!==-1}),N=new V,A=[];return x.forEach(function(B){var G=B.properties.id;N.has(G)||(N.add(G),A.push(B))}),z(A)}function dt(e,o){var u=Z.click(e,null,o),d={mouse:E.NONE};return u[0]&&(d.mouse=u[0].properties.active===M.ACTIVE?E.MOVE:E.POINTER,d.feature=u[0].properties.meta),o.events.currentModeName().indexOf("draw")!==-1&&(d.mouse=E.ADD),o.ui.queueMapClasses(d),o.ui.updateMapClasses(),u[0]}function vt(e,o){var u=e.x-o.x,d=e.y-o.y;return Math.sqrt(u*u+d*d)}function It(e,o,u){u===void 0&&(u={});var d=u.fineTolerance!=null?u.fineTolerance:4,v=u.grossTolerance!=null?u.grossTolerance:12,m=u.interval!=null?u.interval:500;e.point=e.point||o.point,e.time=e.time||o.time;var x=vt(e.point,o.point);return x<d||x<v&&o.time-e.time<m}function Rt(e,o,u){u===void 0&&(u={});var d=u.tolerance!=null?u.tolerance:25,v=u.interval!=null?u.interval:250;return e.point=e.point||o.point,e.time=e.time||o.time,vt(e.point,o.point)<d&&o.time-e.time<v}var Gt={exports:{}},$t=Gt.exports=function(e,o){if(o||(o=16),e===void 0&&(e=128),e<=0)return"0";for(var u=Math.log(Math.pow(2,e))/Math.log(o),d=2;u===1/0;d*=2)u=Math.log(Math.pow(2,e/d))/Math.log(o)*d;var v=u-Math.floor(u),m="";for(d=0;d<Math.floor(u);d++)m=Math.floor(Math.random()*o).toString(o)+m;if(v){var x=Math.pow(o,v);m=Math.floor(Math.random()*x).toString(o)+m}var N=parseInt(m,o);return N!==1/0&&N>=Math.pow(2,e)?$t(e,o):m};$t.rack=function(e,o,u){var d=function(m){var x=0;do{if(x++>10){if(!u)throw new Error("too many ID collisions, use more bits");e+=u}var N=$t(e,o)}while(Object.hasOwnProperty.call(v,N));return v[N]=m,N},v=d.hats={};return d.get=function(m){return d.hats[m]},d.set=function(m,x){return d.hats[m]=x,d},d.bits=e||128,d.base=o||16,d};var Et=i(Gt.exports),_t=function(e,o){this.ctx=e,this.properties=o.properties||{},this.coordinates=o.geometry.coordinates,this.id=o.id||Et(),this.type=o.geometry.type};_t.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},_t.prototype.incomingCoords=function(e){this.setCoordinates(e)},_t.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()},_t.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},_t.prototype.setProperty=function(e,o){this.properties[e]=o},_t.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:_.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},_t.prototype.internal=function(e){var o={id:this.id,meta:b.FEATURE,"meta:type":this.type,active:M.INACTIVE,mode:e};if(this.ctx.options.userProperties)for(var u in this.properties)o["user_"+u]=this.properties[u];return{type:_.FEATURE,properties:o,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var de=function(e,o){_t.call(this,e,o)};(de.prototype=Object.create(_t.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},de.prototype.updateCoordinate=function(e,o,u){this.coordinates=arguments.length===3?[o,u]:[e,o],this.changed()},de.prototype.getCoordinate=function(){return this.getCoordinates()};var Jt=function(e,o){_t.call(this,e,o)};(Jt.prototype=Object.create(_t.prototype)).isValid=function(){return this.coordinates.length>1},Jt.prototype.addCoordinate=function(e,o,u){this.changed();var d=parseInt(e,10);this.coordinates.splice(d,0,[o,u])},Jt.prototype.getCoordinate=function(e){var o=parseInt(e,10);return JSON.parse(JSON.stringify(this.coordinates[o]))},Jt.prototype.removeCoordinate=function(e){this.changed(),this.coordinates.splice(parseInt(e,10),1)},Jt.prototype.updateCoordinate=function(e,o,u){var d=parseInt(e,10);this.coordinates[d]=[o,u],this.changed()};var Ot=function(e,o){_t.call(this,e,o),this.coordinates=this.coordinates.map(function(u){return u.slice(0,-1)})};(Ot.prototype=Object.create(_t.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(e){return e.length>2})},Ot.prototype.incomingCoords=function(e){this.coordinates=e.map(function(o){return o.slice(0,-1)}),this.changed()},Ot.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()},Ot.prototype.addCoordinate=function(e,o,u){this.changed();var d=e.split(".").map(function(v){return parseInt(v,10)});this.coordinates[d[0]].splice(d[1],0,[o,u])},Ot.prototype.removeCoordinate=function(e){this.changed();var o=e.split(".").map(function(d){return parseInt(d,10)}),u=this.coordinates[o[0]];u&&(u.splice(o[1],1),u.length<3&&this.coordinates.splice(o[0],1))},Ot.prototype.getCoordinate=function(e){var o=e.split(".").map(function(d){return parseInt(d,10)}),u=this.coordinates[o[0]];return JSON.parse(JSON.stringify(u[o[1]]))},Ot.prototype.getCoordinates=function(){return this.coordinates.map(function(e){return e.concat([e[0]])})},Ot.prototype.updateCoordinate=function(e,o,u){this.changed();var d=e.split("."),v=parseInt(d[0],10),m=parseInt(d[1],10);this.coordinates[v]===void 0&&(this.coordinates[v]=[]),this.coordinates[v][m]=[o,u]};var Do={MultiPoint:de,MultiLineString:Jt,MultiPolygon:Ot},cr=function(e,o,u,d,v){var m=u.split("."),x=parseInt(m[0],10),N=m[1]?m.slice(1).join("."):null;return e[x][o](N,d,v)},Ct=function(e,o){if(_t.call(this,e,o),delete this.coordinates,this.model=Do[o.geometry.type],this.model===void 0)throw new TypeError(o.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(o.geometry.coordinates)};function Q(e){this.map=e.map,this.drawConfig=JSON.parse(JSON.stringify(e.options||{})),this._ctx=e}(Ct.prototype=Object.create(_t.prototype))._coordinatesToFeatures=function(e){var o=this,u=this.model.bind(this);return e.map(function(d){return new u(o.ctx,{id:Et(),type:_.FEATURE,properties:{},geometry:{coordinates:d,type:o.type.replace("Multi","")}})})},Ct.prototype.isValid=function(){return this.features.every(function(e){return e.isValid()})},Ct.prototype.setCoordinates=function(e){this.features=this._coordinatesToFeatures(e),this.changed()},Ct.prototype.getCoordinate=function(e){return cr(this.features,"getCoordinate",e)},Ct.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(e){return e.type===_.POLYGON?e.getCoordinates():e.coordinates})))},Ct.prototype.updateCoordinate=function(e,o,u){cr(this.features,"updateCoordinate",e,o,u),this.changed()},Ct.prototype.addCoordinate=function(e,o,u){cr(this.features,"addCoordinate",e,o,u),this.changed()},Ct.prototype.removeCoordinate=function(e){cr(this.features,"removeCoordinate",e),this.changed()},Ct.prototype.getFeatures=function(){return this.features},Q.prototype.setSelected=function(e){return this._ctx.store.setSelected(e)},Q.prototype.setSelectedCoordinates=function(e){var o=this;this._ctx.store.setSelectedCoordinates(e),e.reduce(function(u,d){return u[d.feature_id]===void 0&&(u[d.feature_id]=!0,o._ctx.store.get(d.feature_id).changed()),u},{})},Q.prototype.getSelected=function(){return this._ctx.store.getSelected()},Q.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},Q.prototype.isSelected=function(e){return this._ctx.store.isSelected(e)},Q.prototype.getFeature=function(e){return this._ctx.store.get(e)},Q.prototype.select=function(e){return this._ctx.store.select(e)},Q.prototype.deselect=function(e){return this._ctx.store.deselect(e)},Q.prototype.deleteFeature=function(e,o){return o===void 0&&(o={}),this._ctx.store.delete(e,o)},Q.prototype.addFeature=function(e){return this._ctx.store.add(e)},Q.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},Q.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},Q.prototype.setActionableState=function(e){e===void 0&&(e={});var o={trash:e.trash||!1,combineFeatures:e.combineFeatures||!1,uncombineFeatures:e.uncombineFeatures||!1};return this._ctx.events.actionable(o)},Q.prototype.changeMode=function(e,o,u){return o===void 0&&(o={}),u===void 0&&(u={}),this._ctx.events.changeMode(e,o,u)},Q.prototype.updateUIClasses=function(e){return this._ctx.ui.queueMapClasses(e)},Q.prototype.activateUIButton=function(e){return this._ctx.ui.setActiveButton(e)},Q.prototype.featuresAt=function(e,o,u){if(u===void 0&&(u="click"),u!=="click"&&u!=="touch")throw new Error("invalid buffer type");return Z[u](e,o,this._ctx)},Q.prototype.newFeature=function(e){var o=e.geometry.type;return o===_.POINT?new de(this._ctx,e):o===_.LINE_STRING?new Jt(this._ctx,e):o===_.POLYGON?new Ot(this._ctx,e):new Ct(this._ctx,e)},Q.prototype.isInstanceOf=function(e,o){if(e===_.POINT)return o instanceof de;if(e===_.LINE_STRING)return o instanceof Jt;if(e===_.POLYGON)return o instanceof Ot;if(e==="MultiFeature")return o instanceof Ct;throw new Error("Unknown feature class: "+e)},Q.prototype.doRender=function(e){return this._ctx.store.featureChanged(e)},Q.prototype.onSetup=function(){},Q.prototype.onDrag=function(){},Q.prototype.onClick=function(){},Q.prototype.onMouseMove=function(){},Q.prototype.onMouseDown=function(){},Q.prototype.onMouseUp=function(){},Q.prototype.onMouseOut=function(){},Q.prototype.onKeyUp=function(){},Q.prototype.onKeyDown=function(){},Q.prototype.onTouchStart=function(){},Q.prototype.onTouchMove=function(){},Q.prototype.onTouchEnd=function(){},Q.prototype.onTap=function(){},Q.prototype.onStop=function(){},Q.prototype.onTrash=function(){},Q.prototype.onCombineFeature=function(){},Q.prototype.onUncombineFeature=function(){},Q.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var Gn={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},Uo=Object.keys(Gn);function Bo(e){var o=Object.keys(e);return function(u,d){d===void 0&&(d={});var v={},m=o.reduce(function(x,N){return x[N]=e[N],x},new Q(u));return{start:function(){var x=this;v=m.onSetup(d),Uo.forEach(function(N){var A,B=Gn[N],G=function(){return!1};e[B]&&(G=function(){return!0}),x.on(N,G,(A=B,function(D){return m[A](v,D)}))})},stop:function(){m.onStop(v)},trash:function(){m.onTrash(v)},combineFeatures:function(){m.onCombineFeatures(v)},uncombineFeatures:function(){m.onUncombineFeatures(v)},render:function(x,N){m.toDisplayFeatures(v,x,N)}}}}function Xe(e){return[].concat(e).filter(function(o){return o!==void 0})}function Go(){var e=this;if(!(e.ctx.map&&e.ctx.map.getSource(g.HOT)!==void 0))return A();var o=e.ctx.events.currentModeName();e.ctx.ui.queueMapClasses({mode:o});var u=[],d=[];e.isDirty?d=e.getAllIds():(u=e.getChangedIds().filter(function(B){return e.get(B)!==void 0}),d=e.sources.hot.filter(function(B){return B.properties.id&&u.indexOf(B.properties.id)===-1&&e.get(B.properties.id)!==void 0}).map(function(B){return B.properties.id})),e.sources.hot=[];var v=e.sources.cold.length;e.sources.cold=e.isDirty?[]:e.sources.cold.filter(function(B){var G=B.properties.id||B.properties.parent;return u.indexOf(G)===-1});var m=v!==e.sources.cold.length||d.length>0;function x(B,G){var D=e.get(B).internal(o);e.ctx.events.currentModeRender(D,function(q){e.sources[G].push(q)})}if(u.forEach(function(B){return x(B,"hot")}),d.forEach(function(B){return x(B,"cold")}),m&&e.ctx.map.getSource(g.COLD).setData({type:_.FEATURE_COLLECTION,features:e.sources.cold}),e.ctx.map.getSource(g.HOT).setData({type:_.FEATURE_COLLECTION,features:e.sources.hot}),e._emitSelectionChange&&(e.ctx.map.fire(O.SELECTION_CHANGE,{features:e.getSelected().map(function(B){return B.toGeoJSON()}),points:e.getSelectedCoordinates().map(function(B){return{type:_.FEATURE,properties:{},geometry:{type:_.POINT,coordinates:B.coordinates}}})}),e._emitSelectionChange=!1),e._deletedFeaturesToEmit.length){var N=e._deletedFeaturesToEmit.map(function(B){return B.toGeoJSON()});e._deletedFeaturesToEmit=[],e.ctx.map.fire(O.DELETE,{features:N})}function A(){e.isDirty=!1,e.clearChangedIds()}A(),e.ctx.map.fire(O.RENDER,{})}function rt(e){var o,u=this;this._features={},this._featureIds=new V,this._selectedFeatureIds=new V,this._selectedCoordinates=[],this._changedFeatureIds=new V,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=e,this.sources={hot:[],cold:[]},this.render=function(){o||(o=requestAnimationFrame(function(){o=null,Go.call(u)}))},this.isDirty=!1}function Vn(e,o){var u=e._selectedCoordinates.filter(function(d){return e._selectedFeatureIds.has(d.feature_id)});e._selectedCoordinates.length===u.length||o.silent||(e._emitSelectionChange=!0),e._selectedCoordinates=u}rt.prototype.createRenderBatch=function(){var e=this,o=this.render,u=0;return this.render=function(){u++},function(){e.render=o,u>0&&e.render()}},rt.prototype.setDirty=function(){return this.isDirty=!0,this},rt.prototype.featureChanged=function(e){return this._changedFeatureIds.add(e),this},rt.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},rt.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},rt.prototype.getAllIds=function(){return this._featureIds.values()},rt.prototype.add=function(e){return this.featureChanged(e.id),this._features[e.id]=e,this._featureIds.add(e.id),this},rt.prototype.delete=function(e,o){var u=this;return o===void 0&&(o={}),Xe(e).forEach(function(d){u._featureIds.has(d)&&(u._featureIds.delete(d),u._selectedFeatureIds.delete(d),o.silent||u._deletedFeaturesToEmit.indexOf(u._features[d])===-1&&u._deletedFeaturesToEmit.push(u._features[d]),delete u._features[d],u.isDirty=!0)}),Vn(this,o),this},rt.prototype.get=function(e){return this._features[e]},rt.prototype.getAll=function(){var e=this;return Object.keys(this._features).map(function(o){return e._features[o]})},rt.prototype.select=function(e,o){var u=this;return o===void 0&&(o={}),Xe(e).forEach(function(d){u._selectedFeatureIds.has(d)||(u._selectedFeatureIds.add(d),u._changedFeatureIds.add(d),o.silent||(u._emitSelectionChange=!0))}),this},rt.prototype.deselect=function(e,o){var u=this;return o===void 0&&(o={}),Xe(e).forEach(function(d){u._selectedFeatureIds.has(d)&&(u._selectedFeatureIds.delete(d),u._changedFeatureIds.add(d),o.silent||(u._emitSelectionChange=!0))}),Vn(this,o),this},rt.prototype.clearSelected=function(e){return e===void 0&&(e={}),this.deselect(this._selectedFeatureIds.values(),{silent:e.silent}),this},rt.prototype.setSelected=function(e,o){var u=this;return o===void 0&&(o={}),e=Xe(e),this.deselect(this._selectedFeatureIds.values().filter(function(d){return e.indexOf(d)===-1}),{silent:o.silent}),this.select(e.filter(function(d){return!u._selectedFeatureIds.has(d)}),{silent:o.silent}),this},rt.prototype.setSelectedCoordinates=function(e){return this._selectedCoordinates=e,this._emitSelectionChange=!0,this},rt.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},rt.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},rt.prototype.getSelected=function(){var e=this;return this._selectedFeatureIds.values().map(function(o){return e.get(o)})},rt.prototype.getSelectedCoordinates=function(){var e=this;return this._selectedCoordinates.map(function(o){return{coordinates:e.get(o.feature_id).getCoordinate(o.coord_path)}})},rt.prototype.isSelected=function(e){return this._selectedFeatureIds.has(e)},rt.prototype.setFeatureProperty=function(e,o,u){this.get(e).setProperty(o,u),this.featureChanged(e)},rt.prototype.storeMapConfig=function(){var e=this;L.forEach(function(o){e.ctx.map[o]&&(e._mapInitialConfig[o]=e.ctx.map[o].isEnabled())})},rt.prototype.restoreMapConfig=function(){var e=this;Object.keys(this._mapInitialConfig).forEach(function(o){e._mapInitialConfig[o]?e.ctx.map[o].enable():e.ctx.map[o].disable()})},rt.prototype.getInitialConfigValue=function(e){return this._mapInitialConfig[e]===void 0||this._mapInitialConfig[e]};var Vo=function(){for(var e=arguments,o={},u=0;u<arguments.length;u++){var d=e[u];for(var v in d)Yo.call(d,v)&&(o[v]=d[v])}return o},Yo=Object.prototype.hasOwnProperty,ne=i(Vo),jo=["mode","feature","mouse"];function zo(e){var o=null,u=null,d={onRemove:function(){return e.map.off("load",d.connect),clearInterval(u),d.removeLayers(),e.store.restoreMapConfig(),e.ui.removeButtons(),e.events.removeEventListeners(),e.ui.clearMapClasses(),e.boxZoomInitial&&e.map.boxZoom.enable(),e.map=null,e.container=null,e.store=null,o&&o.parentNode&&o.parentNode.removeChild(o),o=null,this},connect:function(){e.map.off("load",d.connect),clearInterval(u),d.addLayers(),e.store.storeMapConfig(),e.events.addEventListeners()},onAdd:function(v){var m=v.fire;return v.fire=function(x,N){var A=arguments;return m.length===1&&arguments.length!==1&&(A=[ne({},{type:x},N)]),m.apply(v,A)},e.map=v,e.events=function(x){var N=Object.keys(x.options.modes).reduce(function(T,X){return T[X]=Bo(x.options.modes[X]),T},{}),A={},B={},G={},D=null,q=null;G.drag=function(T,X){X({point:T.point,time:new Date().getTime()})?(x.ui.queueMapClasses({mouse:E.DRAG}),q.drag(T)):T.originalEvent.stopPropagation()},G.mousedrag=function(T){G.drag(T,function(X){return!It(A,X)})},G.touchdrag=function(T){G.drag(T,function(X){return!Rt(B,X)})},G.mousemove=function(T){if((T.originalEvent.buttons!==void 0?T.originalEvent.buttons:T.originalEvent.which)===1)return G.mousedrag(T);var X=dt(T,x);T.featureTarget=X,q.mousemove(T)},G.mousedown=function(T){A={time:new Date().getTime(),point:T.point};var X=dt(T,x);T.featureTarget=X,q.mousedown(T)},G.mouseup=function(T){var X=dt(T,x);T.featureTarget=X,It(A,{point:T.point,time:new Date().getTime()})?q.click(T):q.mouseup(T)},G.mouseout=function(T){q.mouseout(T)},G.touchstart=function(T){if(x.options.touchEnabled){B={time:new Date().getTime(),point:T.point};var X=Z.touch(T,null,x)[0];T.featureTarget=X,q.touchstart(T)}},G.touchmove=function(T){if(x.options.touchEnabled)return q.touchmove(T),G.touchdrag(T)},G.touchend=function(T){if(T.originalEvent.preventDefault(),x.options.touchEnabled){var X=Z.touch(T,null,x)[0];T.featureTarget=X,Rt(B,{time:new Date().getTime(),point:T.point})?q.tap(T):q.touchend(T)}};var ot=function(T){return!(T===8||T===46||T>=48&&T<=57)};function W(T,X,K){K===void 0&&(K={}),q.stop();var gt=N[T];if(gt===void 0)throw new Error(T+" is not valid");D=T;var lt=gt(x,X);q=r(lt,x),K.silent||x.map.fire(O.MODE_CHANGE,{mode:T}),x.store.setDirty(),x.store.render()}G.keydown=function(T){(T.srcElement||T.target).classList.contains("mapboxgl-canvas")&&(T.keyCode!==8&&T.keyCode!==46||!x.options.controls.trash?ot(T.keyCode)?q.keydown(T):T.keyCode===49&&x.options.controls.point?W(I.DRAW_POINT):T.keyCode===50&&x.options.controls.line_string?W(I.DRAW_LINE_STRING):T.keyCode===51&&x.options.controls.polygon&&W(I.DRAW_POLYGON):(T.preventDefault(),q.trash()))},G.keyup=function(T){ot(T.keyCode)&&q.keyup(T)},G.zoomend=function(){x.store.changeZoom()},G.data=function(T){if(T.dataType==="style"){var X=x.setup,K=x.map,gt=x.options,lt=x.store;gt.styles.some(function(un){return K.getLayer(un.id)})||(X.addLayers(),lt.setDirty(),lt.render())}};var ut={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){D=x.options.defaultMode,q=r(N[D](x),x)},changeMode:W,actionable:function(T){var X=!1;Object.keys(T).forEach(function(K){if(ut[K]===void 0)throw new Error("Invalid action type");ut[K]!==T[K]&&(X=!0),ut[K]=T[K]}),X&&x.map.fire(O.ACTIONABLE,{actions:ut})},currentModeName:function(){return D},currentModeRender:function(T,X){return q.render(T,X)},fire:function(T,X){G[T]&&G[T](X)},addEventListeners:function(){x.map.on("mousemove",G.mousemove),x.map.on("mousedown",G.mousedown),x.map.on("mouseup",G.mouseup),x.map.on("data",G.data),x.map.on("touchmove",G.touchmove),x.map.on("touchstart",G.touchstart),x.map.on("touchend",G.touchend),x.container.addEventListener("mouseout",G.mouseout),x.options.keybindings&&(x.container.addEventListener("keydown",G.keydown),x.container.addEventListener("keyup",G.keyup))},removeEventListeners:function(){x.map.off("mousemove",G.mousemove),x.map.off("mousedown",G.mousedown),x.map.off("mouseup",G.mouseup),x.map.off("data",G.data),x.map.off("touchmove",G.touchmove),x.map.off("touchstart",G.touchstart),x.map.off("touchend",G.touchend),x.container.removeEventListener("mouseout",G.mouseout),x.options.keybindings&&(x.container.removeEventListener("keydown",G.keydown),x.container.removeEventListener("keyup",G.keyup))},trash:function(T){q.trash(T)},combineFeatures:function(){q.combineFeatures()},uncombineFeatures:function(){q.uncombineFeatures()},getMode:function(){return D}}}(e),e.ui=function(x){var N={},A=null,B={mode:null,feature:null,mouse:null},G={mode:null,feature:null,mouse:null};function D(T){G=ne(G,T)}function q(){var T,X;if(x.container){var K=[],gt=[];jo.forEach(function(lt){G[lt]!==B[lt]&&(K.push(lt+"-"+B[lt]),G[lt]!==null&&gt.push(lt+"-"+G[lt]))}),K.length>0&&(T=x.container.classList).remove.apply(T,K),gt.length>0&&(X=x.container.classList).add.apply(X,gt),B=ne(B,G)}}function ot(T,X){X===void 0&&(X={});var K=document.createElement("button");return K.className=h.CONTROL_BUTTON+" "+X.className,K.setAttribute("title",X.title),X.container.appendChild(K),K.addEventListener("click",function(gt){if(gt.preventDefault(),gt.stopPropagation(),gt.target===A)return W(),void X.onDeactivate();ut(T),X.onActivate()},!0),K}function W(){A&&(A.classList.remove(h.ACTIVE_BUTTON),A=null)}function ut(T){W();var X=N[T];X&&X&&T!=="trash"&&(X.classList.add(h.ACTIVE_BUTTON),A=X)}return{setActiveButton:ut,queueMapClasses:D,updateMapClasses:q,clearMapClasses:function(){D({mode:null,feature:null,mouse:null}),q()},addButtons:function(){var T=x.options.controls,X=document.createElement("div");return X.className=h.CONTROL_GROUP+" "+h.CONTROL_BASE,T&&(T[C.LINE]&&(N[C.LINE]=ot(C.LINE,{container:X,className:h.CONTROL_BUTTON_LINE,title:"LineString tool "+(x.options.keybindings?"(l)":""),onActivate:function(){return x.events.changeMode(I.DRAW_LINE_STRING)},onDeactivate:function(){return x.events.trash()}})),T[C.POLYGON]&&(N[C.POLYGON]=ot(C.POLYGON,{container:X,className:h.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(x.options.keybindings?"(p)":""),onActivate:function(){return x.events.changeMode(I.DRAW_POLYGON)},onDeactivate:function(){return x.events.trash()}})),T[C.POINT]&&(N[C.POINT]=ot(C.POINT,{container:X,className:h.CONTROL_BUTTON_POINT,title:"Marker tool "+(x.options.keybindings?"(m)":""),onActivate:function(){return x.events.changeMode(I.DRAW_POINT)},onDeactivate:function(){return x.events.trash()}})),T.trash&&(N.trash=ot("trash",{container:X,className:h.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){x.events.trash()}})),T.combine_features&&(N.combine_features=ot("combineFeatures",{container:X,className:h.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){x.events.combineFeatures()}})),T.uncombine_features&&(N.uncombine_features=ot("uncombineFeatures",{container:X,className:h.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){x.events.uncombineFeatures()}}))),X},removeButtons:function(){Object.keys(N).forEach(function(T){var X=N[T];X.parentNode&&X.parentNode.removeChild(X),delete N[T]})}}}(e),e.container=v.getContainer(),e.store=new rt(e),o=e.ui.addButtons(),e.options.boxSelect&&(e.boxZoomInitial=v.boxZoom.isEnabled(),v.boxZoom.disable(),v.dragPan.disable(),v.dragPan.enable()),v.loaded()?d.connect():(v.on("load",d.connect),u=setInterval(function(){v.loaded()&&d.connect()},16)),e.events.start(),o},addLayers:function(){e.map.addSource(g.COLD,{data:{type:_.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.map.addSource(g.HOT,{data:{type:_.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.options.styles.forEach(function(v){e.map.addLayer(v)}),e.store.setDirty(!0),e.store.render()},removeLayers:function(){e.options.styles.forEach(function(v){e.map.getLayer(v.id)&&e.map.removeLayer(v.id)}),e.map.getSource(g.COLD)&&e.map.removeSource(g.COLD),e.map.getSource(g.HOT)&&e.map.removeSource(g.HOT)}};return e.setup=d,d}var Yn=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function fr(e){return function(o){var u=o.featureTarget;return!!u&&!!u.properties&&u.properties.meta===e}}function jn(e){return!!e.originalEvent&&!!e.originalEvent.shiftKey&&e.originalEvent.button===0}function ge(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.active===M.ACTIVE&&e.featureTarget.properties.meta===b.FEATURE}function tn(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.active===M.INACTIVE&&e.featureTarget.properties.meta===b.FEATURE}function hr(e){return e.featureTarget===void 0}function en(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.meta===b.FEATURE}function $e(e){var o=e.featureTarget;return!!o&&!!o.properties&&o.properties.meta===b.VERTEX}function pr(e){return!!e.originalEvent&&e.originalEvent.shiftKey===!0}function dr(e){return e.keyCode===27}function gr(e){return e.keyCode===13}var Xo=Object.freeze({__proto__:null,isOfMetaType:fr,isShiftMousedown:jn,isActiveFeature:ge,isInactiveFeature:tn,noTarget:hr,isFeature:en,isVertex:$e,isShiftDown:pr,isEscapeKey:dr,isEnterKey:gr,isTrue:function(){return!0}}),$o=Pe;function Pe(e,o){this.x=e,this.y=o}Pe.prototype={clone:function(){return new Pe(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,o){return this.clone()._rotateAround(e,o)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var o=e.x-this.x,u=e.y-this.y;return o*o+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,o){return Math.atan2(this.x*o-this.y*e,this.x*e+this.y*o)},_matMult:function(e){var o=e[0]*this.x+e[1]*this.y,u=e[2]*this.x+e[3]*this.y;return this.x=o,this.y=u,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var o=Math.cos(e),u=Math.sin(e),d=o*this.x-u*this.y,v=u*this.x+o*this.y;return this.x=d,this.y=v,this},_rotateAround:function(e,o){var u=Math.cos(e),d=Math.sin(e),v=o.x+u*(this.x-o.x)-d*(this.y-o.y),m=o.y+d*(this.x-o.x)+u*(this.y-o.y);return this.x=v,this.y=m,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Pe.convert=function(e){return e instanceof Pe?e:Array.isArray(e)?new Pe(e[0],e[1]):e};var Jo=i($o);function rn(e,o){var u=o.getBoundingClientRect();return new Jo(e.clientX-u.left-(o.clientLeft||0),e.clientY-u.top-(o.clientTop||0))}function Ie(e,o,u,d){return{type:_.FEATURE,properties:{meta:b.VERTEX,parent:e,coord_path:u,active:d?M.ACTIVE:M.INACTIVE},geometry:{type:_.POINT,coordinates:o}}}function zn(e,o,u){var d=o.geometry.coordinates,v=u.geometry.coordinates;if(d[1]>85||d[1]<F||v[1]>85||v[1]<F)return null;var m={lng:(d[0]+v[0])/2,lat:(d[1]+v[1])/2};return{type:_.FEATURE,properties:{meta:b.MIDPOINT,parent:e,lng:m.lng,lat:m.lat,coord_path:u.properties.coord_path},geometry:{type:_.POINT,coordinates:[m.lng,m.lat]}}}function vr(e,o,u){o===void 0&&(o={}),u===void 0&&(u=null);var d,v=e.geometry,m=v.type,x=v.coordinates,N=e.properties&&e.properties.id,A=[];function B(D,q){var ot="",W=null;D.forEach(function(ut,T){var X=q!=null?q+"."+T:String(T),K=Ie(N,ut,X,G(X));if(o.midpoints&&W){var gt=zn(N,W,K);gt&&A.push(gt)}W=K;var lt=JSON.stringify(ut);ot!==lt&&A.push(K),T===0&&(ot=lt)})}function G(D){return!!o.selectedPaths&&o.selectedPaths.indexOf(D)!==-1}return m===_.POINT?A.push(Ie(N,x,u,G(u))):m===_.POLYGON?x.forEach(function(D,q){B(D,u!==null?u+"."+q:String(q))}):m===_.LINE_STRING?B(x,u):m.indexOf(_.MULTI_PREFIX)===0&&(d=m.replace(_.MULTI_PREFIX,""),x.forEach(function(D,q){var ot={type:_.FEATURE,properties:e.properties,geometry:{type:d,coordinates:D}};A=A.concat(vr(ot,o,q))})),A}var kt={enable:function(e){setTimeout(function(){e.map&&e.map.doubleClickZoom&&e._ctx&&e._ctx.store&&e._ctx.store.getInitialConfigValue&&e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()},0)},disable:function(e){setTimeout(function(){e.map&&e.map.doubleClickZoom&&e.map.doubleClickZoom.disable()},0)}},yr={exports:{}},Xn=function(e){if(!e||!e.type)return null;var o=qo[e.type];if(!o)return null;if(o==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:e}]};if(o==="feature")return{type:"FeatureCollection",features:[e]};if(o==="featurecollection")return e},qo={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},Zo=i(Xn),Wo=Object.freeze({__proto__:null,default:function e(o){switch(o&&o.type||null){case"FeatureCollection":return o.features=o.features.reduce(function(u,d){return u.concat(e(d))},[]),o;case"Feature":return o.geometry?e(o.geometry).map(function(u){var d={type:"Feature",properties:JSON.parse(JSON.stringify(o.properties)),geometry:u};return o.id!==void 0&&(d.id=o.id),d}):[o];case"MultiPoint":return o.coordinates.map(function(u){return{type:"Point",coordinates:u}});case"MultiPolygon":return o.coordinates.map(function(u){return{type:"Polygon",coordinates:u}});case"MultiLineString":return o.coordinates.map(function(u){return{type:"LineString",coordinates:u}});case"GeometryCollection":return o.geometries.map(e).reduce(function(u,d){return u.concat(d)},[]);case"Point":case"Polygon":case"LineString":return[o]}}}),Qo=Xn,mr=a(Wo),Ho=function(e){return function o(u){return Array.isArray(u)&&u.length&&typeof u[0]=="number"?[u]:u.reduce(function(d,v){return Array.isArray(v)&&Array.isArray(v[0])?d.concat(o(v)):(d.push(v),d)},[])}(e)};mr instanceof Function||(mr=mr.default);var $n={exports:{}},Ko=$n.exports=function(e){return new Tt(e)};function Tt(e){this.value=e}function Jn(e,o,u){var d=[],v=[],m=!0;return function x(N){var A=u?qn(N):N,B={},G=!0,D={node:A,node_:N,path:[].concat(d),parent:v[v.length-1],parents:v,key:d.slice(-1)[0],isRoot:d.length===0,level:d.length,circular:null,update:function(W,ut){D.isRoot||(D.parent.node[D.key]=W),D.node=W,ut&&(G=!1)},delete:function(W){delete D.parent.node[D.key],W&&(G=!1)},remove:function(W){Zn(D.parent.node)?D.parent.node.splice(D.key,1):delete D.parent.node[D.key],W&&(G=!1)},keys:null,before:function(W){B.before=W},after:function(W){B.after=W},pre:function(W){B.pre=W},post:function(W){B.post=W},stop:function(){m=!1},block:function(){G=!1}};if(!m)return D;function q(){if(typeof D.node=="object"&&D.node!==null){D.keys&&D.node_===D.node||(D.keys=br(D.node)),D.isLeaf=D.keys.length==0;for(var W=0;W<v.length;W++)if(v[W].node_===N){D.circular=v[W];break}}else D.isLeaf=!0,D.keys=null;D.notLeaf=!D.isLeaf,D.notRoot=!D.isRoot}q();var ot=o.call(D,D.node);return ot!==void 0&&D.update&&D.update(ot),B.before&&B.before.call(D,D.node),G&&(typeof D.node!="object"||D.node===null||D.circular||(v.push(D),q(),Er(D.keys,function(W,ut){d.push(W),B.pre&&B.pre.call(D,D.node[W],W);var T=x(D.node[W]);u&&_r.call(D.node,W)&&(D.node[W]=T.node),T.isLast=ut==D.keys.length-1,T.isFirst=ut==0,B.post&&B.post.call(D,T),d.pop()}),v.pop()),B.after&&B.after.call(D,D.node)),D}(e).node}function qn(e){if(typeof e=="object"&&e!==null){var o;if(Zn(e))o=[];else if(Oe(e)==="[object Date]")o=new Date(e.getTime?e.getTime():e);else if(function(v){return Oe(v)==="[object RegExp]"}(e))o=new RegExp(e);else if(function(v){return Oe(v)==="[object Error]"}(e))o={message:e.message};else if(function(v){return Oe(v)==="[object Boolean]"}(e))o=new Boolean(e);else if(function(v){return Oe(v)==="[object Number]"}(e))o=new Number(e);else if(function(v){return Oe(v)==="[object String]"}(e))o=new String(e);else if(Object.create&&Object.getPrototypeOf)o=Object.create(Object.getPrototypeOf(e));else if(e.constructor===Object)o={};else{var u=e.constructor&&e.constructor.prototype||e.__proto__||{},d=function(){};d.prototype=u,o=new d}return Er(br(e),function(v){o[v]=e[v]}),o}return e}Tt.prototype.get=function(e){for(var o=this.value,u=0;u<e.length;u++){var d=e[u];if(!o||!_r.call(o,d)){o=void 0;break}o=o[d]}return o},Tt.prototype.has=function(e){for(var o=this.value,u=0;u<e.length;u++){var d=e[u];if(!o||!_r.call(o,d))return!1;o=o[d]}return!0},Tt.prototype.set=function(e,o){for(var u=this.value,d=0;d<e.length-1;d++){var v=e[d];_r.call(u,v)||(u[v]={}),u=u[v]}return u[e[d]]=o,o},Tt.prototype.map=function(e){return Jn(this.value,e,!0)},Tt.prototype.forEach=function(e){return this.value=Jn(this.value,e,!1),this.value},Tt.prototype.reduce=function(e,o){var u=arguments.length===1,d=u?this.value:o;return this.forEach(function(v){this.isRoot&&u||(d=e.call(this,d,v))}),d},Tt.prototype.paths=function(){var e=[];return this.forEach(function(o){e.push(this.path)}),e},Tt.prototype.nodes=function(){var e=[];return this.forEach(function(o){e.push(this.node)}),e},Tt.prototype.clone=function(){var e=[],o=[];return function u(d){for(var v=0;v<e.length;v++)if(e[v]===d)return o[v];if(typeof d=="object"&&d!==null){var m=qn(d);return e.push(d),o.push(m),Er(br(d),function(x){m[x]=u(d[x])}),e.pop(),o.pop(),m}return d}(this.value)};var br=Object.keys||function(e){var o=[];for(var u in e)o.push(u);return o};function Oe(e){return Object.prototype.toString.call(e)}var Zn=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},Er=function(e,o){if(e.forEach)return e.forEach(o);for(var u=0;u<e.length;u++)o(e[u],u,e)};Er(br(Tt.prototype),function(e){Ko[e]=function(o){var u=[].slice.call(arguments,1),d=new Tt(o);return d[e].apply(d,u)}});var _r=Object.hasOwnProperty||function(e,o){return o in e},ts=$n.exports,es=xt;function xt(e){if(!(this instanceof xt))return new xt(e);this._bbox=e||[1/0,1/0,-1/0,-1/0],this._valid=!!e}xt.prototype.include=function(e){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],e[0]),this._bbox[1]=Math.min(this._bbox[1],e[1]),this._bbox[2]=Math.max(this._bbox[2],e[0]),this._bbox[3]=Math.max(this._bbox[3],e[1]),this},xt.prototype.equals=function(e){var o;return o=e instanceof xt?e.bbox():e,this._bbox[0]==o[0]&&this._bbox[1]==o[1]&&this._bbox[2]==o[2]&&this._bbox[3]==o[3]},xt.prototype.center=function(e){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},xt.prototype.union=function(e){var o;return this._valid=!0,o=e instanceof xt?e.bbox():e,this._bbox[0]=Math.min(this._bbox[0],o[0]),this._bbox[1]=Math.min(this._bbox[1],o[1]),this._bbox[2]=Math.max(this._bbox[2],o[2]),this._bbox[3]=Math.max(this._bbox[3],o[3]),this},xt.prototype.bbox=function(){return this._valid?this._bbox:null},xt.prototype.contains=function(e){if(!e)return this._fastContains();if(!this._valid)return null;var o=e[0],u=e[1];return this._bbox[0]<=o&&this._bbox[1]<=u&&this._bbox[2]>=o&&this._bbox[3]>=u},xt.prototype.intersect=function(e){return this._valid?(o=e instanceof xt?e.bbox():e,!(this._bbox[0]>o[2]||this._bbox[2]<o[0]||this._bbox[3]<o[1]||this._bbox[1]>o[3])):null;var o},xt.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var e="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",e)},xt.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var rs=function(e){if(!e)return[];var o=mr(Qo(e)),u=[];return o.features.forEach(function(d){d.geometry&&(u=u.concat(Ho(d.geometry.coordinates)))}),u},ns=ts,is=es,Wn={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},os=Object.keys(Wn);function nn(e){for(var o=is(),u=rs(e),d=0;d<u.length;d++)o.include(u[d]);return o}yr.exports=function(e){return nn(e).bbox()},yr.exports.polygon=function(e){return nn(e).polygon()},yr.exports.bboxify=function(e){return ns(e).map(function(o){o&&os.some(function(u){return!!o[u]&&Wn[u].indexOf(o.type)!==-1})&&(o.bbox=nn(o).bbox(),this.update(o))})};var ss=i(yr.exports),xr=-90;function on(e,o){var u=xr,d=90,v=xr,m=90,x=270,N=-270;e.forEach(function(B){var G=ss(B),D=G[1],q=G[3],ot=G[0],W=G[2];D>u&&(u=D),q<d&&(d=q),q>v&&(v=q),D<m&&(m=D),ot<x&&(x=ot),W>N&&(N=W)});var A=o;return u+A.lat>85&&(A.lat=85-u),v+A.lat>90&&(A.lat=90-v),d+A.lat<-85&&(A.lat=-85-d),m+A.lat<xr&&(A.lat=xr-m),x+A.lng<=-270&&(A.lng+=360*Math.ceil(Math.abs(A.lng)/360)),N+A.lng>=270&&(A.lng-=360*Math.ceil(Math.abs(A.lng)/360)),A}function sn(e,o){var u=on(e.map(function(d){return d.toGeoJSON()}),o);e.forEach(function(d){var v,m=d.getCoordinates(),x=function(A){var B={lng:A[0]+u.lng,lat:A[1]+u.lat};return[B.lng,B.lat]},N=function(A){return A.map(function(B){return x(B)})};d.type===_.POINT?v=x(m):d.type===_.LINE_STRING||d.type===_.MULTI_POINT?v=m.map(x):d.type===_.POLYGON||d.type===_.MULTI_LINE_STRING?v=m.map(N):d.type===_.MULTI_POLYGON&&(v=m.map(function(A){return A.map(function(B){return N(B)})})),d.incomingCoords(v)})}var ft={onSetup:function(e){var o=this,u={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:e.featureIds||[]};return this.setSelected(u.initiallySelectedFeatureIds.filter(function(d){return o.getFeature(d)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),u},fireUpdate:function(){this.map.fire(O.UPDATE,{action:y.MOVE,features:this.getSelected().map(function(e){return e.toGeoJSON()})})},fireActionable:function(){var e=this,o=this.getSelected(),u=o.filter(function(N){return e.isInstanceOf("MultiFeature",N)}),d=!1;if(o.length>1){d=!0;var v=o[0].type.replace("Multi","");o.forEach(function(N){N.type.replace("Multi","")!==v&&(d=!1)})}var m=u.length>0,x=o.length>0;this.setActionableState({combineFeatures:d,uncombineFeatures:m,trash:x})},getUniqueIds:function(e){return e.length?e.map(function(o){return o.properties.id}).filter(function(o){return o!==void 0}).reduce(function(o,u){return o.add(u),o},new V).values():[]},stopExtendedInteractions:function(e){e.boxSelectElement&&(e.boxSelectElement.parentNode&&e.boxSelectElement.parentNode.removeChild(e.boxSelectElement),e.boxSelectElement=null),this.map.dragPan.enable(),e.boxSelecting=!1,e.canBoxSelect=!1,e.dragMoving=!1,e.canDragMove=!1},onStop:function(){kt.enable(this)},onMouseMove:function(e,o){return en(o)&&e.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(e),!0},onMouseOut:function(e){return!e.dragMoving||this.fireUpdate()}};ft.onTap=ft.onClick=function(e,o){return hr(o)?this.clickAnywhere(e,o):fr(b.VERTEX)(o)?this.clickOnVertex(e,o):en(o)?this.clickOnFeature(e,o):void 0},ft.clickAnywhere=function(e){var o=this,u=this.getSelectedIds();u.length&&(this.clearSelectedFeatures(),u.forEach(function(d){return o.doRender(d)})),kt.enable(this),this.stopExtendedInteractions(e)},ft.clickOnVertex=function(e,o){this.changeMode(I.DIRECT_SELECT,{featureId:o.featureTarget.properties.parent,coordPath:o.featureTarget.properties.coord_path,startPos:o.lngLat}),this.updateUIClasses({mouse:E.MOVE})},ft.startOnActiveFeature=function(e,o){this.stopExtendedInteractions(e),this.map.dragPan.disable(),this.doRender(o.featureTarget.properties.id),e.canDragMove=!0,e.dragMoveLocation=o.lngLat},ft.clickOnFeature=function(e,o){var u=this;kt.disable(this),this.stopExtendedInteractions(e);var d=pr(o),v=this.getSelectedIds(),m=o.featureTarget.properties.id,x=this.isSelected(m);if(!d&&x&&this.getFeature(m).type!==_.POINT)return this.changeMode(I.DIRECT_SELECT,{featureId:m});x&&d?(this.deselect(m),this.updateUIClasses({mouse:E.POINTER}),v.length===1&&kt.enable(this)):!x&&d?(this.select(m),this.updateUIClasses({mouse:E.MOVE})):x||d||(v.forEach(function(N){return u.doRender(N)}),this.setSelected(m),this.updateUIClasses({mouse:E.MOVE})),this.doRender(m)},ft.onMouseDown=function(e,o){return ge(o)?this.startOnActiveFeature(e,o):this.drawConfig.boxSelect&&jn(o)?this.startBoxSelect(e,o):void 0},ft.startBoxSelect=function(e,o){this.stopExtendedInteractions(e),this.map.dragPan.disable(),e.boxSelectStartLocation=rn(o.originalEvent,this.map.getContainer()),e.canBoxSelect=!0},ft.onTouchStart=function(e,o){if(ge(o))return this.startOnActiveFeature(e,o)},ft.onDrag=function(e,o){return e.canDragMove?this.dragMove(e,o):this.drawConfig.boxSelect&&e.canBoxSelect?this.whileBoxSelect(e,o):void 0},ft.whileBoxSelect=function(e,o){e.boxSelecting=!0,this.updateUIClasses({mouse:E.ADD}),e.boxSelectElement||(e.boxSelectElement=document.createElement("div"),e.boxSelectElement.classList.add(h.BOX_SELECT),this.map.getContainer().appendChild(e.boxSelectElement));var u=rn(o.originalEvent,this.map.getContainer()),d=Math.min(e.boxSelectStartLocation.x,u.x),v=Math.max(e.boxSelectStartLocation.x,u.x),m=Math.min(e.boxSelectStartLocation.y,u.y),x=Math.max(e.boxSelectStartLocation.y,u.y),N="translate("+d+"px, "+m+"px)";e.boxSelectElement.style.transform=N,e.boxSelectElement.style.WebkitTransform=N,e.boxSelectElement.style.width=v-d+"px",e.boxSelectElement.style.height=x-m+"px"},ft.dragMove=function(e,o){e.dragMoving=!0,o.originalEvent.stopPropagation();var u={lng:o.lngLat.lng-e.dragMoveLocation.lng,lat:o.lngLat.lat-e.dragMoveLocation.lat};sn(this.getSelected(),u),e.dragMoveLocation=o.lngLat},ft.onTouchEnd=ft.onMouseUp=function(e,o){var u=this;if(e.dragMoving)this.fireUpdate();else if(e.boxSelecting){var d=[e.boxSelectStartLocation,rn(o.originalEvent,this.map.getContainer())],v=this.featuresAt(null,d,"click"),m=this.getUniqueIds(v).filter(function(x){return!u.isSelected(x)});m.length&&(this.select(m),m.forEach(function(x){return u.doRender(x)}),this.updateUIClasses({mouse:E.MOVE}))}this.stopExtendedInteractions(e)},ft.toDisplayFeatures=function(e,o,u){o.properties.active=this.isSelected(o.properties.id)?M.ACTIVE:M.INACTIVE,u(o),this.fireActionable(),o.properties.active===M.ACTIVE&&o.geometry.type!==_.POINT&&vr(o).forEach(u)},ft.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},ft.onCombineFeatures=function(){var e=this.getSelected();if(!(e.length===0||e.length<2)){for(var o=[],u=[],d=e[0].type.replace("Multi",""),v=0;v<e.length;v++){var m=e[v];if(m.type.replace("Multi","")!==d)return;m.type.includes("Multi")?m.getCoordinates().forEach(function(N){o.push(N)}):o.push(m.getCoordinates()),u.push(m.toGeoJSON())}if(u.length>1){var x=this.newFeature({type:_.FEATURE,properties:u[0].properties,geometry:{type:"Multi"+d,coordinates:o}});this.addFeature(x),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([x.id]),this.map.fire(O.COMBINE_FEATURES,{createdFeatures:[x.toGeoJSON()],deletedFeatures:u})}this.fireActionable()}},ft.onUncombineFeatures=function(){var e=this,o=this.getSelected();if(o.length!==0){for(var u=[],d=[],v=function(x){var N=o[x];e.isInstanceOf("MultiFeature",N)&&(N.getFeatures().forEach(function(A){e.addFeature(A),A.properties=N.properties,u.push(A.toGeoJSON()),e.select([A.id])}),e.deleteFeature(N.id,{silent:!0}),d.push(N.toGeoJSON()))},m=0;m<o.length;m++)v(m);u.length>1&&this.map.fire(O.UNCOMBINE_FEATURES,{createdFeatures:u,deletedFeatures:d}),this.fireActionable()}};var Qn=fr(b.VERTEX),Hn=fr(b.MIDPOINT),ie={fireUpdate:function(){this.map.fire(O.UPDATE,{action:y.CHANGE_COORDINATES,features:this.getSelected().map(function(e){return e.toGeoJSON()})})},fireActionable:function(e){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:e.selectedCoordPaths.length>0})},startDragging:function(e,o){this.map.dragPan.disable(),e.canDragMove=!0,e.dragMoveLocation=o.lngLat},stopDragging:function(e){this.map.dragPan.enable(),e.dragMoving=!1,e.canDragMove=!1,e.dragMoveLocation=null},onVertex:function(e,o){this.startDragging(e,o);var u=o.featureTarget.properties,d=e.selectedCoordPaths.indexOf(u.coord_path);pr(o)||d!==-1?pr(o)&&d===-1&&e.selectedCoordPaths.push(u.coord_path):e.selectedCoordPaths=[u.coord_path];var v=this.pathsToCoordinates(e.featureId,e.selectedCoordPaths);this.setSelectedCoordinates(v)},onMidpoint:function(e,o){this.startDragging(e,o);var u=o.featureTarget.properties;e.feature.addCoordinate(u.coord_path,u.lng,u.lat),this.fireUpdate(),e.selectedCoordPaths=[u.coord_path]},pathsToCoordinates:function(e,o){return o.map(function(u){return{feature_id:e,coord_path:u}})},onFeature:function(e,o){e.selectedCoordPaths.length===0?this.startDragging(e,o):this.stopDragging(e)},dragFeature:function(e,o,u){sn(this.getSelected(),u),e.dragMoveLocation=o.lngLat},dragVertex:function(e,o,u){for(var d=e.selectedCoordPaths.map(function(N){return e.feature.getCoordinate(N)}),v=on(d.map(function(N){return{type:_.FEATURE,properties:{},geometry:{type:_.POINT,coordinates:N}}}),u),m=0;m<d.length;m++){var x=d[m];e.feature.updateCoordinate(e.selectedCoordPaths[m],x[0]+v.lng,x[1]+v.lat)}},clickNoTarget:function(){this.changeMode(I.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(I.SIMPLE_SELECT)},clickActiveFeature:function(e){e.selectedCoordPaths=[],this.clearSelectedCoordinates(),e.feature.changed()},onSetup:function(e){var o=e.featureId,u=this.getFeature(o);if(!u)throw new Error("You must provide a featureId to enter direct_select mode");if(u.type===_.POINT)throw new TypeError("direct_select mode doesn't handle point features");var d={featureId:o,feature:u,dragMoveLocation:e.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:e.coordPath?[e.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(o,d.selectedCoordPaths)),this.setSelected(o),kt.disable(this),this.setActionableState({trash:!0}),d},onStop:function(){kt.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(e,o,u){e.featureId===o.properties.id?(o.properties.active=M.ACTIVE,u(o),vr(o,{map:this.map,midpoints:!0,selectedPaths:e.selectedCoordPaths}).forEach(u)):(o.properties.active=M.INACTIVE,u(o)),this.fireActionable(e)},onTrash:function(e){e.selectedCoordPaths.sort(function(o,u){return u.localeCompare(o,"en",{numeric:!0})}).forEach(function(o){return e.feature.removeCoordinate(o)}),this.fireUpdate(),e.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(e),e.feature.isValid()===!1&&(this.deleteFeature([e.featureId]),this.changeMode(I.SIMPLE_SELECT,{}))},onMouseMove:function(e,o){var u=ge(o),d=Qn(o),v=Hn(o),m=e.selectedCoordPaths.length===0;return u&&m||d&&!m?this.updateUIClasses({mouse:E.MOVE}):this.updateUIClasses({mouse:E.NONE}),(d||u||v)&&e.dragMoving&&this.fireUpdate(),this.stopDragging(e),!0},onMouseOut:function(e){return e.dragMoving&&this.fireUpdate(),!0}};ie.onTouchStart=ie.onMouseDown=function(e,o){return Qn(o)?this.onVertex(e,o):ge(o)?this.onFeature(e,o):Hn(o)?this.onMidpoint(e,o):void 0},ie.onDrag=function(e,o){if(e.canDragMove===!0){e.dragMoving=!0,o.originalEvent.stopPropagation();var u={lng:o.lngLat.lng-e.dragMoveLocation.lng,lat:o.lngLat.lat-e.dragMoveLocation.lat};e.selectedCoordPaths.length>0?this.dragVertex(e,o,u):this.dragFeature(e,o,u),e.dragMoveLocation=o.lngLat}},ie.onClick=function(e,o){return hr(o)?this.clickNoTarget(e,o):ge(o)?this.clickActiveFeature(e,o):tn(o)?this.clickInactive(e,o):void this.stopDragging(e)},ie.onTap=function(e,o){return hr(o)?this.clickNoTarget(e,o):ge(o)?this.clickActiveFeature(e,o):tn(o)?this.clickInactive(e,o):void 0},ie.onTouchEnd=ie.onMouseUp=function(e){e.dragMoving&&this.fireUpdate(),this.stopDragging(e)};var Vt={};function wr(e,o){return!!e.lngLat&&e.lngLat.lng===o[0]&&e.lngLat.lat===o[1]}Vt.onSetup=function(){var e=this.newFeature({type:_.FEATURE,properties:{},geometry:{type:_.POINT,coordinates:[]}});return this.addFeature(e),this.clearSelectedFeatures(),this.updateUIClasses({mouse:E.ADD}),this.activateUIButton(C.POINT),this.setActionableState({trash:!0}),{point:e}},Vt.stopDrawingAndRemove=function(e){this.deleteFeature([e.point.id],{silent:!0}),this.changeMode(I.SIMPLE_SELECT)},Vt.onTap=Vt.onClick=function(e,o){this.updateUIClasses({mouse:E.MOVE}),e.point.updateCoordinate("",o.lngLat.lng,o.lngLat.lat),this.map.fire(O.CREATE,{features:[e.point.toGeoJSON()]}),this.changeMode(I.SIMPLE_SELECT,{featureIds:[e.point.id]})},Vt.onStop=function(e){this.activateUIButton(),e.point.getCoordinate().length||this.deleteFeature([e.point.id],{silent:!0})},Vt.toDisplayFeatures=function(e,o,u){var d=o.properties.id===e.point.id;if(o.properties.active=d?M.ACTIVE:M.INACTIVE,!d)return u(o)},Vt.onTrash=Vt.stopDrawingAndRemove,Vt.onKeyUp=function(e,o){if(dr(o)||gr(o))return this.stopDrawingAndRemove(e,o)};var ve={onSetup:function(){var e=this.newFeature({type:_.FEATURE,properties:{},geometry:{type:_.POLYGON,coordinates:[[]]}});return this.addFeature(e),this.clearSelectedFeatures(),kt.disable(this),this.updateUIClasses({mouse:E.ADD}),this.activateUIButton(C.POLYGON),this.setActionableState({trash:!0}),{polygon:e,currentVertexPosition:0}},clickAnywhere:function(e,o){if(e.currentVertexPosition>0&&wr(o,e.polygon.coordinates[0][e.currentVertexPosition-1]))return this.changeMode(I.SIMPLE_SELECT,{featureIds:[e.polygon.id]});this.updateUIClasses({mouse:E.ADD}),e.polygon.updateCoordinate("0."+e.currentVertexPosition,o.lngLat.lng,o.lngLat.lat),e.currentVertexPosition++,e.polygon.updateCoordinate("0."+e.currentVertexPosition,o.lngLat.lng,o.lngLat.lat)},clickOnVertex:function(e){return this.changeMode(I.SIMPLE_SELECT,{featureIds:[e.polygon.id]})},onMouseMove:function(e,o){e.polygon.updateCoordinate("0."+e.currentVertexPosition,o.lngLat.lng,o.lngLat.lat),$e(o)&&this.updateUIClasses({mouse:E.POINTER})}};ve.onTap=ve.onClick=function(e,o){return $e(o)?this.clickOnVertex(e,o):this.clickAnywhere(e,o)},ve.onKeyUp=function(e,o){dr(o)?(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(I.SIMPLE_SELECT)):gr(o)&&this.changeMode(I.SIMPLE_SELECT,{featureIds:[e.polygon.id]})},ve.onStop=function(e){this.updateUIClasses({mouse:E.NONE}),kt.enable(this),this.activateUIButton(),this.getFeature(e.polygon.id)!==void 0&&(e.polygon.removeCoordinate("0."+e.currentVertexPosition),e.polygon.isValid()?this.map.fire(O.CREATE,{features:[e.polygon.toGeoJSON()]}):(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(I.SIMPLE_SELECT,{},{silent:!0})))},ve.toDisplayFeatures=function(e,o,u){var d=o.properties.id===e.polygon.id;if(o.properties.active=d?M.ACTIVE:M.INACTIVE,!d)return u(o);if(o.geometry.coordinates.length!==0){var v=o.geometry.coordinates[0].length;if(!(v<3)){if(o.properties.meta=b.FEATURE,u(Ie(e.polygon.id,o.geometry.coordinates[0][0],"0.0",!1)),v>3){var m=o.geometry.coordinates[0].length-3;u(Ie(e.polygon.id,o.geometry.coordinates[0][m],"0."+m,!1))}if(v<=4){var x=[[o.geometry.coordinates[0][0][0],o.geometry.coordinates[0][0][1]],[o.geometry.coordinates[0][1][0],o.geometry.coordinates[0][1][1]]];if(u({type:_.FEATURE,properties:o.properties,geometry:{coordinates:x,type:_.LINE_STRING}}),v===3)return}return u(o)}}},ve.onTrash=function(e){this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(I.SIMPLE_SELECT)};var ye={onSetup:function(e){var o,u,d=(e=e||{}).featureId,v="forward";if(d){if(!(o=this.getFeature(d)))throw new Error("Could not find a feature with the provided featureId");var m=e.from;if(m&&m.type==="Feature"&&m.geometry&&m.geometry.type==="Point"&&(m=m.geometry),m&&m.type==="Point"&&m.coordinates&&m.coordinates.length===2&&(m=m.coordinates),!m||!Array.isArray(m))throw new Error("Please use the `from` property to indicate which point to continue the line from");var x=o.coordinates.length-1;if(o.coordinates[x][0]===m[0]&&o.coordinates[x][1]===m[1])u=x+1,o.addCoordinate.apply(o,[u].concat(o.coordinates[x]));else{if(o.coordinates[0][0]!==m[0]||o.coordinates[0][1]!==m[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");v="backwards",u=0,o.addCoordinate.apply(o,[u].concat(o.coordinates[0]))}}else o=this.newFeature({type:_.FEATURE,properties:{},geometry:{type:_.LINE_STRING,coordinates:[]}}),u=0,this.addFeature(o);return this.clearSelectedFeatures(),kt.disable(this),this.updateUIClasses({mouse:E.ADD}),this.activateUIButton(C.LINE),this.setActionableState({trash:!0}),{line:o,currentVertexPosition:u,direction:v}},clickAnywhere:function(e,o){if(e.currentVertexPosition>0&&wr(o,e.line.coordinates[e.currentVertexPosition-1])||e.direction==="backwards"&&wr(o,e.line.coordinates[e.currentVertexPosition+1]))return this.changeMode(I.SIMPLE_SELECT,{featureIds:[e.line.id]});this.updateUIClasses({mouse:E.ADD}),e.line.updateCoordinate(e.currentVertexPosition,o.lngLat.lng,o.lngLat.lat),e.direction==="forward"?(e.currentVertexPosition++,e.line.updateCoordinate(e.currentVertexPosition,o.lngLat.lng,o.lngLat.lat)):e.line.addCoordinate(0,o.lngLat.lng,o.lngLat.lat)},clickOnVertex:function(e){return this.changeMode(I.SIMPLE_SELECT,{featureIds:[e.line.id]})},onMouseMove:function(e,o){e.line.updateCoordinate(e.currentVertexPosition,o.lngLat.lng,o.lngLat.lat),$e(o)&&this.updateUIClasses({mouse:E.POINTER})}};ye.onTap=ye.onClick=function(e,o){if($e(o))return this.clickOnVertex(e,o);this.clickAnywhere(e,o)},ye.onKeyUp=function(e,o){gr(o)?this.changeMode(I.SIMPLE_SELECT,{featureIds:[e.line.id]}):dr(o)&&(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(I.SIMPLE_SELECT))},ye.onStop=function(e){kt.enable(this),this.activateUIButton(),this.getFeature(e.line.id)!==void 0&&(e.line.removeCoordinate(""+e.currentVertexPosition),e.line.isValid()?this.map.fire(O.CREATE,{features:[e.line.toGeoJSON()]}):(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(I.SIMPLE_SELECT,{},{silent:!0})))},ye.onTrash=function(e){this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(I.SIMPLE_SELECT)},ye.toDisplayFeatures=function(e,o,u){var d=o.properties.id===e.line.id;if(o.properties.active=d?M.ACTIVE:M.INACTIVE,!d)return u(o);o.geometry.coordinates.length<2||(o.properties.meta=b.FEATURE,u(Ie(e.line.id,o.geometry.coordinates[e.direction==="forward"?o.geometry.coordinates.length-2:1],""+(e.direction==="forward"?o.geometry.coordinates.length-2:1),!1)),u(o))};var Kn={simple_select:ft,direct_select:ie,draw_point:Vt,draw_polygon:ve,draw_line_string:ye},as={defaultMode:I.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:Yn,modes:Kn,controls:{},userProperties:!1},us={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},ls={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function ti(e,o){return e.map(function(u){return u.source?u:ne(u,{id:u.id+"."+o,source:o==="hot"?g.HOT:g.COLD})})}var an={exports:{}};(function(e,o){var u="__lodash_hash_undefined__",d=9007199254740991,v="[object Arguments]",m="[object Array]",x="[object Boolean]",N="[object Date]",A="[object Error]",B="[object Function]",G="[object Map]",D="[object Number]",q="[object Object]",ot="[object Promise]",W="[object RegExp]",ut="[object Set]",T="[object String]",X="[object Symbol]",K="[object WeakMap]",gt="[object ArrayBuffer]",lt="[object DataView]",un=/^\[object .+?Constructor\]$/,ps=/^(?:0|[1-9]\d*)$/,nt={};nt["[object Float32Array]"]=nt["[object Float64Array]"]=nt["[object Int8Array]"]=nt["[object Int16Array]"]=nt["[object Int32Array]"]=nt["[object Uint8Array]"]=nt["[object Uint8ClampedArray]"]=nt["[object Uint16Array]"]=nt["[object Uint32Array]"]=!0,nt[v]=nt[m]=nt[gt]=nt[x]=nt[lt]=nt[N]=nt[A]=nt[B]=nt[G]=nt[D]=nt[q]=nt[W]=nt[ut]=nt[T]=nt[K]=!1;var ni=typeof Ue=="object"&&Ue&&Ue.Object===Object&&Ue,ds=typeof self=="object"&&self&&self.Object===Object&&self,qt=ni||ds||Function("return this")(),ii=o&&!o.nodeType&&o,oi=ii&&e&&!e.nodeType&&e,si=oi&&oi.exports===ii,ln=si&&ni.process,ai=function(){try{return ln&&ln.binding&&ln.binding("util")}catch{}}(),ui=ai&&ai.isTypedArray;function gs(S,P){for(var U=-1,$=S==null?0:S.length;++U<$;)if(P(S[U],U,S))return!0;return!1}function vs(S){var P=-1,U=Array(S.size);return S.forEach(function($,it){U[++P]=[it,$]}),U}function ys(S){var P=-1,U=Array(S.size);return S.forEach(function($){U[++P]=$}),U}var li,ci,fi,ms=Array.prototype,bs=Function.prototype,Mr=Object.prototype,cn=qt["__core-js_shared__"],hi=bs.toString,Yt=Mr.hasOwnProperty,pi=(li=/[^.]+$/.exec(cn&&cn.keys&&cn.keys.IE_PROTO||""))?"Symbol(src)_1."+li:"",di=Mr.toString,Es=RegExp("^"+hi.call(Yt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),gi=si?qt.Buffer:void 0,Cr=qt.Symbol,vi=qt.Uint8Array,yi=Mr.propertyIsEnumerable,_s=ms.splice,me=Cr?Cr.toStringTag:void 0,mi=Object.getOwnPropertySymbols,xs=gi?gi.isBuffer:void 0,ws=(ci=Object.keys,fi=Object,function(S){return ci(fi(S))}),fn=Te(qt,"DataView"),Je=Te(qt,"Map"),hn=Te(qt,"Promise"),pn=Te(qt,"Set"),dn=Te(qt,"WeakMap"),qe=Te(Object,"create"),Ss=_e(fn),Ms=_e(Je),Cs=_e(hn),Ps=_e(pn),Is=_e(dn),bi=Cr?Cr.prototype:void 0,gn=bi?bi.valueOf:void 0;function be(S){var P=-1,U=S==null?0:S.length;for(this.clear();++P<U;){var $=S[P];this.set($[0],$[1])}}function Zt(S){var P=-1,U=S==null?0:S.length;for(this.clear();++P<U;){var $=S[P];this.set($[0],$[1])}}function Ee(S){var P=-1,U=S==null?0:S.length;for(this.clear();++P<U;){var $=S[P];this.set($[0],$[1])}}function Pr(S){var P=-1,U=S==null?0:S.length;for(this.__data__=new Ee;++P<U;)this.add(S[P])}function oe(S){var P=this.__data__=new Zt(S);this.size=P.size}function Os(S,P){var U=Tr(S),$=!U&&As(S),it=!U&&!$&&vn(S),H=!U&&!$&&!it&&Ii(S),st=U||$||it||H,ct=st?function(pt,jt){for(var Wt=-1,wt=Array(pt);++Wt<pt;)wt[Wt]=jt(Wt);return wt}(S.length,String):[],Dt=ct.length;for(var ht in S)!P&&!Yt.call(S,ht)||st&&(ht=="length"||it&&(ht=="offset"||ht=="parent")||H&&(ht=="buffer"||ht=="byteLength"||ht=="byteOffset")||Ns(ht,Dt))||ct.push(ht);return ct}function Ir(S,P){for(var U=S.length;U--;)if(Si(S[U][0],P))return U;return-1}function Ze(S){return S==null?S===void 0?"[object Undefined]":"[object Null]":me&&me in Object(S)?function(P){var U=Yt.call(P,me),$=P[me];try{P[me]=void 0;var it=!0}catch{}var H=di.call(P);return it&&(U?P[me]=$:delete P[me]),H}(S):function(P){return di.call(P)}(S)}function Ei(S){return We(S)&&Ze(S)==v}function _i(S,P,U,$,it){return S===P||(S==null||P==null||!We(S)&&!We(P)?S!=S&&P!=P:function(H,st,ct,Dt,ht,pt){var jt=Tr(H),Wt=Tr(st),wt=jt?m:se(H),Qt=Wt?m:se(st),Le=(wt=wt==v?q:wt)==q,Lr=(Qt=Qt==v?q:Qt)==q,Fe=wt==Qt;if(Fe&&vn(H)){if(!vn(st))return!1;jt=!0,Le=!1}if(Fe&&!Le)return pt||(pt=new oe),jt||Ii(H)?xi(H,st,ct,Dt,ht,pt):function(et,tt,Fr,ae,yn,Lt,Ht){switch(Fr){case lt:if(et.byteLength!=tt.byteLength||et.byteOffset!=tt.byteOffset)return!1;et=et.buffer,tt=tt.buffer;case gt:return!(et.byteLength!=tt.byteLength||!Lt(new vi(et),new vi(tt)));case x:case N:case D:return Si(+et,+tt);case A:return et.name==tt.name&&et.message==tt.message;case W:case T:return et==tt+"";case G:var ue=vs;case ut:var He=1&ae;if(ue||(ue=ys),et.size!=tt.size&&!He)return!1;var Nr=Ht.get(et);if(Nr)return Nr==tt;ae|=2,Ht.set(et,tt);var Ne=xi(ue(et),ue(tt),ae,yn,Lt,Ht);return Ht.delete(et),Ne;case X:if(gn)return gn.call(et)==gn.call(tt)}return!1}(H,st,wt,ct,Dt,ht,pt);if(!(1&ct)){var Qe=Le&&Yt.call(H,"__wrapped__"),Oi=Lr&&Yt.call(st,"__wrapped__");if(Qe||Oi){var ks=Qe?H.value():H,Ds=Oi?st.value():st;return pt||(pt=new oe),ht(ks,Ds,ct,Dt,pt)}}return Fe?(pt||(pt=new oe),function(et,tt,Fr,ae,yn,Lt){var Ht=1&Fr,ue=wi(et),He=ue.length,Nr=wi(tt).length;if(He!=Nr&&!Ht)return!1;for(var Ne=He;Ne--;){var xe=ue[Ne];if(!(Ht?xe in tt:Yt.call(tt,xe)))return!1}var Ti=Lt.get(et);if(Ti&&Lt.get(tt))return Ti==tt;var Ar=!0;Lt.set(et,tt),Lt.set(tt,et);for(var mn=Ht;++Ne<He;){var Rr=et[xe=ue[Ne]],kr=tt[xe];if(ae)var Li=Ht?ae(kr,Rr,xe,tt,et,Lt):ae(Rr,kr,xe,et,tt,Lt);if(!(Li===void 0?Rr===kr||yn(Rr,kr,Fr,ae,Lt):Li)){Ar=!1;break}mn||(mn=xe=="constructor")}if(Ar&&!mn){var Dr=et.constructor,Ur=tt.constructor;Dr==Ur||!("constructor"in et)||!("constructor"in tt)||typeof Dr=="function"&&Dr instanceof Dr&&typeof Ur=="function"&&Ur instanceof Ur||(Ar=!1)}return Lt.delete(et),Lt.delete(tt),Ar}(H,st,ct,Dt,ht,pt)):!1}(S,P,U,$,_i,it))}function Ts(S){return!(!Pi(S)||function(P){return!!pi&&pi in P}(S))&&(Mi(S)?Es:un).test(_e(S))}function Ls(S){if(U=(P=S)&&P.constructor,$=typeof U=="function"&&U.prototype||Mr,P!==$)return ws(S);var P,U,$,it=[];for(var H in Object(S))Yt.call(S,H)&&H!="constructor"&&it.push(H);return it}function xi(S,P,U,$,it,H){var st=1&U,ct=S.length,Dt=P.length;if(ct!=Dt&&!(st&&Dt>ct))return!1;var ht=H.get(S);if(ht&&H.get(P))return ht==P;var pt=-1,jt=!0,Wt=2&U?new Pr:void 0;for(H.set(S,P),H.set(P,S);++pt<ct;){var wt=S[pt],Qt=P[pt];if($)var Le=st?$(Qt,wt,pt,P,S,H):$(wt,Qt,pt,S,P,H);if(Le!==void 0){if(Le)continue;jt=!1;break}if(Wt){if(!gs(P,function(Lr,Fe){if(Qe=Fe,!Wt.has(Qe)&&(wt===Lr||it(wt,Lr,U,$,H)))return Wt.push(Fe);var Qe})){jt=!1;break}}else if(wt!==Qt&&!it(wt,Qt,U,$,H)){jt=!1;break}}return H.delete(S),H.delete(P),jt}function wi(S){return function(P,U,$){var it=U(P);return Tr(P)?it:function(H,st){for(var ct=-1,Dt=st.length,ht=H.length;++ct<Dt;)H[ht+ct]=st[ct];return H}(it,$(P))}(S,Rs,Fs)}function Or(S,P){var U,$,it=S.__data__;return(($=typeof(U=P))=="string"||$=="number"||$=="symbol"||$=="boolean"?U!=="__proto__":U===null)?it[typeof P=="string"?"string":"hash"]:it.map}function Te(S,P){var U=function($,it){return $==null?void 0:$[it]}(S,P);return Ts(U)?U:void 0}be.prototype.clear=function(){this.__data__=qe?qe(null):{},this.size=0},be.prototype.delete=function(S){var P=this.has(S)&&delete this.__data__[S];return this.size-=P?1:0,P},be.prototype.get=function(S){var P=this.__data__;if(qe){var U=P[S];return U===u?void 0:U}return Yt.call(P,S)?P[S]:void 0},be.prototype.has=function(S){var P=this.__data__;return qe?P[S]!==void 0:Yt.call(P,S)},be.prototype.set=function(S,P){var U=this.__data__;return this.size+=this.has(S)?0:1,U[S]=qe&&P===void 0?u:P,this},Zt.prototype.clear=function(){this.__data__=[],this.size=0},Zt.prototype.delete=function(S){var P=this.__data__,U=Ir(P,S);return!(U<0)&&(U==P.length-1?P.pop():_s.call(P,U,1),--this.size,!0)},Zt.prototype.get=function(S){var P=this.__data__,U=Ir(P,S);return U<0?void 0:P[U][1]},Zt.prototype.has=function(S){return Ir(this.__data__,S)>-1},Zt.prototype.set=function(S,P){var U=this.__data__,$=Ir(U,S);return $<0?(++this.size,U.push([S,P])):U[$][1]=P,this},Ee.prototype.clear=function(){this.size=0,this.__data__={hash:new be,map:new(Je||Zt),string:new be}},Ee.prototype.delete=function(S){var P=Or(this,S).delete(S);return this.size-=P?1:0,P},Ee.prototype.get=function(S){return Or(this,S).get(S)},Ee.prototype.has=function(S){return Or(this,S).has(S)},Ee.prototype.set=function(S,P){var U=Or(this,S),$=U.size;return U.set(S,P),this.size+=U.size==$?0:1,this},Pr.prototype.add=Pr.prototype.push=function(S){return this.__data__.set(S,u),this},Pr.prototype.has=function(S){return this.__data__.has(S)},oe.prototype.clear=function(){this.__data__=new Zt,this.size=0},oe.prototype.delete=function(S){var P=this.__data__,U=P.delete(S);return this.size=P.size,U},oe.prototype.get=function(S){return this.__data__.get(S)},oe.prototype.has=function(S){return this.__data__.has(S)},oe.prototype.set=function(S,P){var U=this.__data__;if(U instanceof Zt){var $=U.__data__;if(!Je||$.length<199)return $.push([S,P]),this.size=++U.size,this;U=this.__data__=new Ee($)}return U.set(S,P),this.size=U.size,this};var Fs=mi?function(S){return S==null?[]:(S=Object(S),function(P,U){for(var $=-1,it=P==null?0:P.length,H=0,st=[];++$<it;){var ct=P[$];U(ct,$,P)&&(st[H++]=ct)}return st}(mi(S),function(P){return yi.call(S,P)}))}:function(){return[]},se=Ze;function Ns(S,P){return!!(P=P??d)&&(typeof S=="number"||ps.test(S))&&S>-1&&S%1==0&&S<P}function _e(S){if(S!=null){try{return hi.call(S)}catch{}try{return S+""}catch{}}return""}function Si(S,P){return S===P||S!=S&&P!=P}(fn&&se(new fn(new ArrayBuffer(1)))!=lt||Je&&se(new Je)!=G||hn&&se(hn.resolve())!=ot||pn&&se(new pn)!=ut||dn&&se(new dn)!=K)&&(se=function(S){var P=Ze(S),U=P==q?S.constructor:void 0,$=U?_e(U):"";if($)switch($){case Ss:return lt;case Ms:return G;case Cs:return ot;case Ps:return ut;case Is:return K}return P});var As=Ei(function(){return arguments}())?Ei:function(S){return We(S)&&Yt.call(S,"callee")&&!yi.call(S,"callee")},Tr=Array.isArray,vn=xs||function(){return!1};function Mi(S){if(!Pi(S))return!1;var P=Ze(S);return P==B||P=="[object GeneratorFunction]"||P=="[object AsyncFunction]"||P=="[object Proxy]"}function Ci(S){return typeof S=="number"&&S>-1&&S%1==0&&S<=d}function Pi(S){var P=typeof S;return S!=null&&(P=="object"||P=="function")}function We(S){return S!=null&&typeof S=="object"}var Ii=ui?function(S){return function(P){return S(P)}}(ui):function(S){return We(S)&&Ci(S.length)&&!!nt[Ze(S)]};function Rs(S){return(P=S)!=null&&Ci(P.length)&&!Mi(P)?Os(S):Ls(S);var P}e.exports=function(S,P){return _i(S,P)}})(an,an.exports);var ei=i(an.exports);function ri(e,o){return e.length===o.length&&JSON.stringify(e.map(function(u){return u}).sort())===JSON.stringify(o.map(function(u){return u}).sort())}var cs={Polygon:Ot,LineString:Jt,Point:de,MultiPolygon:Ct,MultiLineString:Ct,MultiPoint:Ct},fs=Object.freeze({__proto__:null,CommonSelectors:Xo,constrainFeatureMovement:on,createMidPoint:zn,createSupplementaryPoints:vr,createVertex:Ie,doubleClickZoom:kt,euclideanDistance:vt,featuresAt:Z,getFeatureAtAndSetCursors:dt,isClick:It,isEventAtCoordinates:wr,isTap:Rt,mapEventToBoundingBox:j,ModeHandler:r,moveFeatures:sn,sortFeatures:z,stringSetsAreEqual:ri,StringSet:V,theme:Yn,toDenseArray:Xe}),hs=function(e,o){var u={options:e=function(v){v===void 0&&(v={});var m=ne(v);return v.controls||(m.controls={}),v.displayControlsDefault===!1?m.controls=ne(ls,v.controls):m.controls=ne(us,v.controls),(m=ne(as,m)).styles=ti(m.styles,"cold").concat(ti(m.styles,"hot")),m}(e)};o=function(v,m){return m.modes=I,m.getFeatureIdsAt=function(x){return Z.click({point:x},null,v).map(function(N){return N.properties.id})},m.getSelectedIds=function(){return v.store.getSelectedIds()},m.getSelected=function(){return{type:_.FEATURE_COLLECTION,features:v.store.getSelectedIds().map(function(x){return v.store.get(x)}).map(function(x){return x.toGeoJSON()})}},m.getSelectedPoints=function(){return{type:_.FEATURE_COLLECTION,features:v.store.getSelectedCoordinates().map(function(x){return{type:_.FEATURE,properties:{},geometry:{type:_.POINT,coordinates:x.coordinates}}})}},m.set=function(x){if(x.type===void 0||x.type!==_.FEATURE_COLLECTION||!Array.isArray(x.features))throw new Error("Invalid FeatureCollection");var N=v.store.createRenderBatch(),A=v.store.getAllIds().slice(),B=m.add(x),G=new V(B);return(A=A.filter(function(D){return!G.has(D)})).length&&m.delete(A),N(),B},m.add=function(x){var N=JSON.parse(JSON.stringify(Zo(x))).features.map(function(A){if(A.id=A.id||Et(),A.geometry===null)throw new Error("Invalid geometry: null");if(v.store.get(A.id)===void 0||v.store.get(A.id).type!==A.geometry.type){var B=cs[A.geometry.type];if(B===void 0)throw new Error("Invalid geometry type: "+A.geometry.type+".");var G=new B(v,A);v.store.add(G)}else{var D=v.store.get(A.id);D.properties=A.properties,ei(D.properties,A.properties)||v.store.featureChanged(D.id),ei(D.getCoordinates(),A.geometry.coordinates)||D.incomingCoords(A.geometry.coordinates)}return A.id});return v.store.render(),N},m.get=function(x){var N=v.store.get(x);if(N)return N.toGeoJSON()},m.getAll=function(){return{type:_.FEATURE_COLLECTION,features:v.store.getAll().map(function(x){return x.toGeoJSON()})}},m.delete=function(x){return v.store.delete(x,{silent:!0}),m.getMode()!==I.DIRECT_SELECT||v.store.getSelectedIds().length?v.store.render():v.events.changeMode(I.SIMPLE_SELECT,void 0,{silent:!0}),m},m.deleteAll=function(){return v.store.delete(v.store.getAllIds(),{silent:!0}),m.getMode()===I.DIRECT_SELECT?v.events.changeMode(I.SIMPLE_SELECT,void 0,{silent:!0}):v.store.render(),m},m.changeMode=function(x,N){return N===void 0&&(N={}),x===I.SIMPLE_SELECT&&m.getMode()===I.SIMPLE_SELECT?(ri(N.featureIds||[],v.store.getSelectedIds())||(v.store.setSelected(N.featureIds,{silent:!0}),v.store.render()),m):(x===I.DIRECT_SELECT&&m.getMode()===I.DIRECT_SELECT&&N.featureId===v.store.getSelectedIds()[0]||v.events.changeMode(x,N,{silent:!0}),m)},m.getMode=function(){return v.events.getMode()},m.trash=function(){return v.events.trash({silent:!0}),m},m.combineFeatures=function(){return v.events.combineFeatures({silent:!0}),m},m.uncombineFeatures=function(){return v.events.uncombineFeatures({silent:!0}),m},m.setFeatureProperty=function(x,N,A){return v.store.setFeatureProperty(x,N,A),m},m}(u,o),u.api=o;var d=zo(u);return o.onAdd=d.onAdd,o.onRemove=d.onRemove,o.types=C,o.options=e,o};function Sr(e){hs(e,this)}return Sr.modes=Kn,Sr.constants=R,Sr.lib=fs,Sr})})(fo);var or=fo.exports;const Me=co(or),Be="select_feature",er=`${Be}_highlight`,Bs={highlightColor:"#222"},ho=Me.constants,Gs=Me.lib,Ce={};Ce.onSetup=function(n){const{selectHighlightColor:t,onSelect:r,onCancel:i}=n,a={};a.hoveredFeatureID=null,a.selectedFeatureID=null,a.onSelect=r,a.onCancel=i,a.api=this._ctx.api;const{selectHighlightColor:s=Bs.highlightColor}=this._ctx.options;return a.options={selectHighlightColor:t||s},a};Ce.onMouseMove=function(n,t){const{api:r}=n,{featureTarget:i}=t;if(i){this.updateUIClasses({mouse:ho.cursors.POINTER});const a=i.properties.id;n.hoveredFeatureID!==null&&n.hoveredFeatureID!==a&&r.setFeatureProperty(n.hoveredFeatureID,er,void 0),n.hoveredFeatureID=a,r.setFeatureProperty(n.hoveredFeatureID,er,n.options.selectHighlightColor)}else n.hoveredFeatureID&&r.setFeatureProperty(n.hoveredFeatureID,er,void 0),n.hoveredFeatureID=null};Ce.onClick=function(n,t){n.selectedFeatureID=n.hoveredFeatureID,this.onStop(n,t)};Ce.toDisplayFeatures=function(n,t,r){r(t)};Ce.onKeyUp=function(n,t){CommonSelectors.isEscapeKey(t)&&typeof n.onCancel=="function"&&setTimeout(n.onCancel,0)};Ce.onStop=function(n){this.updateUIClasses({mouse:ho.cursors.NONE}),Gs.doubleClickZoom.enable(this),this.activateUIButton(),n.selectedFeatureID?(typeof n.onSelect=="function"?setTimeout(n.onSelect.bind(null,n.selectedFeatureID),0):this.map.fire("draw.select_mode.select",{featureID:n.selectedFeatureID}),n.selectedFeatureID=null):typeof n.onCancel=="function"&&setTimeout(n.onCancel,0),n.hoveredFeatureID&&(this._ctx.api.setFeatureProperty(n.hoveredFeatureID,er,void 0),n.hoveredFeatureID=null)};const Kt=`user_${er}`,Vs=n=>n.concat([{id:`${Be}-fill`,type:"fill",filter:["all",["==","$type","Polygon"],["has",Kt]],paint:{"fill-color":["get",Kt],"fill-outline-color":["get",Kt],"fill-opacity":.2}},{id:`${Be}-stroke`,type:"line",filter:["all",["==","$type","Polygon"],["has",Kt]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["get",Kt],"line-dasharray":[.2,2],"line-width":2}},{id:`${Be}-line`,type:"line",filter:["all",["==","$type","LineString"],["has",Kt]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["get",Kt],"line-dasharray":[.2,2],"line-width":2}},{id:`${Be}-point`,type:"circle",filter:["all",["==","$type","Point"],["has",Kt]],paint:{"circle-color":["get",Kt],"circle-radius":3}}]);function po(n){return{...n,[Be]:Ce}}function go(n){if(!n)throw new Error("geojson is required");switch(n.type){case"Feature":return vo(n);case"FeatureCollection":return Ys(n);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return Nn(n);default:throw new Error("unknown GeoJSON type")}}function vo(n){var t={type:"Feature"};return Object.keys(n).forEach(function(r){switch(r){case"type":case"properties":case"geometry":return;default:t[r]=n[r]}}),t.properties=yo(n.properties),t.geometry=Nn(n.geometry),t}function yo(n){var t={};return n&&Object.keys(n).forEach(function(r){var i=n[r];typeof i=="object"?i===null?t[r]=null:Array.isArray(i)?t[r]=i.map(function(a){return a}):t[r]=yo(i):t[r]=i}),t}function Ys(n){var t={type:"FeatureCollection"};return Object.keys(n).forEach(function(r){switch(r){case"type":case"features":return;default:t[r]=n[r]}}),t.features=n.features.map(function(r){return vo(r)}),t}function Nn(n){var t={type:n.type};return n.bbox&&(t.bbox=n.bbox),n.type==="GeometryCollection"?(t.geometries=n.geometries.map(function(r){return Nn(r)}),t):(t.coordinates=mo(n.coordinates),t)}function mo(n){var t=n;return typeof t[0]!="object"?t.slice():t.map(function(r){return mo(r)})}var bt=63710088e-1,An={centimeters:bt*100,centimetres:bt*100,degrees:bt/111325,feet:bt*3.28084,inches:bt*39.37,kilometers:bt/1e3,kilometres:bt/1e3,meters:bt,metres:bt,miles:bt/1609.344,millimeters:bt*1e3,millimetres:bt*1e3,nauticalmiles:bt/1852,radians:1,yards:bt*1.0936},js={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/bt,yards:1.0936133},xn={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function At(n,t,r){r===void 0&&(r={});var i={type:"Feature"};return(r.id===0||r.id)&&(i.id=r.id),r.bbox&&(i.bbox=r.bbox),i.properties=t||{},i.geometry=n,i}function zs(n,t,r){switch(n){case"Point":return Xt(t).geometry;case"LineString":return Pt(t).geometry;case"Polygon":return Ge(t).geometry;case"MultiPoint":return bo(t).geometry;case"MultiLineString":return Wr(t).geometry;case"MultiPolygon":return Qr(t).geometry;default:throw new Error(n+" is invalid")}}function Xt(n,t,r){if(r===void 0&&(r={}),!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Xr(n[0])||!Xr(n[1]))throw new Error("coordinates must contain numbers");var i={type:"Point",coordinates:n};return At(i,t,r)}function Xs(n,t,r){return r===void 0&&(r={}),re(n.map(function(i){return Xt(i,t)}),r)}function Ge(n,t,r){r===void 0&&(r={});for(var i=0,a=n;i<a.length;i++){var s=a[i];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var c=0;c<s[s.length-1].length;c++)if(s[s.length-1][c]!==s[0][c])throw new Error("First and last Position are not equivalent.")}var l={type:"Polygon",coordinates:n};return At(l,t,r)}function $s(n,t,r){return r===void 0&&(r={}),re(n.map(function(i){return Ge(i,t)}),r)}function Pt(n,t,r){if(r===void 0&&(r={}),n.length<2)throw new Error("coordinates must be an array of two or more positions");var i={type:"LineString",coordinates:n};return At(i,t,r)}function Js(n,t,r){return r===void 0&&(r={}),re(n.map(function(i){return Pt(i,t)}),r)}function re(n,t){t===void 0&&(t={});var r={type:"FeatureCollection"};return t.id&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.features=n,r}function Wr(n,t,r){r===void 0&&(r={});var i={type:"MultiLineString",coordinates:n};return At(i,t,r)}function bo(n,t,r){r===void 0&&(r={});var i={type:"MultiPoint",coordinates:n};return At(i,t,r)}function Qr(n,t,r){r===void 0&&(r={});var i={type:"MultiPolygon",coordinates:n};return At(i,t,r)}function qs(n,t,r){r===void 0&&(r={});var i={type:"GeometryCollection",geometries:n};return At(i,t,r)}function Zs(n,t){if(t===void 0&&(t=0),t&&!(t>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,t||0);return Math.round(n*r)/r}function Eo(n,t){t===void 0&&(t="kilometers");var r=An[t];if(!r)throw new Error(t+" units is invalid");return n*r}function Rn(n,t){t===void 0&&(t="kilometers");var r=An[t];if(!r)throw new Error(t+" units is invalid");return n/r}function _o(n,t){return xo(Rn(n,t))}function Ws(n){var t=n%360;return t<0&&(t+=360),t}function xo(n){var t=n%(2*Math.PI);return t*180/Math.PI}function Qs(n){var t=n%360;return t*Math.PI/180}function Hs(n,t,r){if(t===void 0&&(t="kilometers"),r===void 0&&(r="kilometers"),!(n>=0))throw new Error("length must be a positive number");return Eo(Rn(n,t),r)}function Ks(n,t,r){if(t===void 0&&(t="meters"),r===void 0&&(r="kilometers"),!(n>=0))throw new Error("area must be a positive number");var i=xn[t];if(!i)throw new Error("invalid original units");var a=xn[r];if(!a)throw new Error("invalid final units");return n/i*a}function Xr(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function sr(n){return!!n&&n.constructor===Object}function ta(n){if(!n)throw new Error("bbox is required");if(!Array.isArray(n))throw new Error("bbox must be an Array");if(n.length!==4&&n.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");n.forEach(function(t){if(!Xr(t))throw new Error("bbox must only contain numbers")})}function ea(n){if(!n)throw new Error("id is required");if(["string","number"].indexOf(typeof n)===-1)throw new Error("id must be a number or a string")}const ra=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:xn,bearingToAzimuth:Ws,convertArea:Ks,convertLength:Hs,degreesToRadians:Qs,earthRadius:bt,factors:An,feature:At,featureCollection:re,geometry:zs,geometryCollection:qs,isNumber:Xr,isObject:sr,lengthToDegrees:_o,lengthToRadians:Rn,lineString:Pt,lineStrings:Js,multiLineString:Wr,multiPoint:bo,multiPolygon:Qr,point:Xt,points:Xs,polygon:Ge,polygons:$s,radiansToDegrees:xo,radiansToLength:Eo,round:Zs,unitsFactors:js,validateBBox:ta,validateId:ea},Symbol.toStringTag,{value:"Module"}));function na(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return n.geometry.coordinates;if(n.type==="Point")return n.coordinates}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return n;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Nt(n){if(Array.isArray(n))return n;if(n.type==="Feature"){if(n.geometry!==null)return n.geometry.coordinates}else if(n.coordinates)return n.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Se(n){return n.type==="Feature"?n.geometry:n}function ia(n,t){return n.type==="FeatureCollection"?"FeatureCollection":n.type==="GeometryCollection"?"GeometryCollection":n.type==="Feature"&&n.geometry!==null?n.geometry.type:n.type}function wn(n){for(var t=Nt(n),r=0,i=1,a,s;i<t.length;)a=s||t[0],s=t[i],r+=(s[0]-a[0])*(s[1]+a[1]),i++;return r>0}function je(n,t,r){if(n!==null)for(var i,a,s,c,l,f,p,w=0,h=0,g,E=n.type,C=E==="FeatureCollection",_=E==="Feature",I=C?n.features.length:1,O=0;O<I;O++){p=C?n.features[O].geometry:_?n.geometry:n,g=p?p.type==="GeometryCollection":!1,l=g?p.geometries.length:1;for(var y=0;y<l;y++){var b=0,M=0;if(c=g?p.geometries[y]:p,c!==null){f=c.coordinates;var L=c.type;switch(w=r&&(L==="Polygon"||L==="MultiPolygon")?1:0,L){case null:break;case"Point":if(t(f,h,O,b,M)===!1)return!1;h++,b++;break;case"LineString":case"MultiPoint":for(i=0;i<f.length;i++){if(t(f[i],h,O,b,M)===!1)return!1;h++,L==="MultiPoint"&&b++}L==="LineString"&&b++;break;case"Polygon":case"MultiLineString":for(i=0;i<f.length;i++){for(a=0;a<f[i].length-w;a++){if(t(f[i][a],h,O,b,M)===!1)return!1;h++}L==="MultiLineString"&&b++,L==="Polygon"&&M++}L==="Polygon"&&b++;break;case"MultiPolygon":for(i=0;i<f.length;i++){for(M=0,a=0;a<f[i].length;a++){for(s=0;s<f[i][a].length-w;s++){if(t(f[i][a][s],h,O,b,M)===!1)return!1;h++}M++}b++}break;case"GeometryCollection":for(i=0;i<c.geometries.length;i++)if(je(c.geometries[i],t,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function oa(n,t,r,i){var a=r;return je(n,function(s,c,l,f,p){c===0&&r===void 0?a=s:a=t(a,s,c,l,f,p)},i),a}function wo(n,t){var r;switch(n.type){case"FeatureCollection":for(r=0;r<n.features.length&&t(n.features[r].properties,r)!==!1;r++);break;case"Feature":t(n.properties,0);break}}function sa(n,t,r){var i=r;return wo(n,function(a,s){s===0&&r===void 0?i=a:i=t(i,a,s)}),i}function Ve(n,t){if(n.type==="Feature")t(n,0);else if(n.type==="FeatureCollection")for(var r=0;r<n.features.length&&t(n.features[r],r)!==!1;r++);}function aa(n,t,r){var i=r;return Ve(n,function(a,s){s===0&&r===void 0?i=a:i=t(i,a,s)}),i}function ua(n){var t=[];return je(n,function(r){t.push(r)}),t}function ar(n,t){var r,i,a,s,c,l,f,p,w,h,g=0,E=n.type==="FeatureCollection",C=n.type==="Feature",_=E?n.features.length:1;for(r=0;r<_;r++){for(l=E?n.features[r].geometry:C?n.geometry:n,p=E?n.features[r].properties:C?n.properties:{},w=E?n.features[r].bbox:C?n.bbox:void 0,h=E?n.features[r].id:C?n.id:void 0,f=l?l.type==="GeometryCollection":!1,c=f?l.geometries.length:1,a=0;a<c;a++){if(s=f?l.geometries[a]:l,s===null){if(t(null,g,p,w,h)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(s,g,p,w,h)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<s.geometries.length;i++)if(t(s.geometries[i],g,p,w,h)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}g++}}function la(n,t,r){var i=r;return ar(n,function(a,s,c,l,f){s===0&&r===void 0?i=a:i=t(i,a,s,c,l,f)}),i}function he(n,t){ar(n,function(r,i,a,s,c){var l=r===null?null:r.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return t(At(r,a,{bbox:s,id:c}),i,0)===!1?!1:void 0}var f;switch(l){case"MultiPoint":f="Point";break;case"MultiLineString":f="LineString";break;case"MultiPolygon":f="Polygon";break}for(var p=0;p<r.coordinates.length;p++){var w=r.coordinates[p],h={type:f,coordinates:w};if(t(At(h,a),i,p)===!1)return!1}})}function ca(n,t,r){var i=r;return he(n,function(a,s,c){s===0&&c===0&&r===void 0?i=a:i=t(i,a,s,c)}),i}function So(n,t){he(n,function(r,i,a){var s=0;if(r.geometry){var c=r.geometry.type;if(!(c==="Point"||c==="MultiPoint")){var l,f=0,p=0,w=0;if(je(r,function(h,g,E,C,_){if(l===void 0||i>f||C>p||_>w){l=h,f=i,p=C,w=_,s=0;return}var I=Pt([l,h],r.properties);if(t(I,i,a,_,s)===!1)return!1;s++,l=h})===!1)return!1}}})}function fa(n,t,r){var i=r,a=!1;return So(n,function(s,c,l,f,p){a===!1&&r===void 0?i=s:i=t(i,s,c,l,f,p),a=!0}),i}function Mo(n,t){if(!n)throw new Error("geojson is required");he(n,function(r,i,a){if(r.geometry!==null){var s=r.geometry.type,c=r.geometry.coordinates;switch(s){case"LineString":if(t(r,i,a,0,0)===!1)return!1;break;case"Polygon":for(var l=0;l<c.length;l++)if(t(Pt(c[l],r.properties),i,a,l)===!1)return!1;break}}})}function ha(n,t,r){var i=r;return Mo(n,function(a,s,c,l){s===0&&r===void 0?i=a:i=t(i,a,s,c,l)}),i}function pa(n,t){if(t=t||{},!sr(t))throw new Error("options is invalid");var r=t.featureIndex||0,i=t.multiFeatureIndex||0,a=t.geometryIndex||0,s=t.segmentIndex||0,c=t.properties,l;switch(n.type){case"FeatureCollection":r<0&&(r=n.features.length+r),c=c||n.features[r].properties,l=n.features[r].geometry;break;case"Feature":c=c||n.properties,l=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=n;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var f=l.coordinates;switch(l.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=f.length+s-1),Pt([f[s],f[s+1]],c,t);case"Polygon":return a<0&&(a=f.length+a),s<0&&(s=f[a].length+s-1),Pt([f[a][s],f[a][s+1]],c,t);case"MultiLineString":return i<0&&(i=f.length+i),s<0&&(s=f[i].length+s-1),Pt([f[i][s],f[i][s+1]],c,t);case"MultiPolygon":return i<0&&(i=f.length+i),a<0&&(a=f[i].length+a),s<0&&(s=f[i][a].length-s-1),Pt([f[i][a][s],f[i][a][s+1]],c,t)}throw new Error("geojson is invalid")}function da(n,t){if(t=t||{},!sr(t))throw new Error("options is invalid");var r=t.featureIndex||0,i=t.multiFeatureIndex||0,a=t.geometryIndex||0,s=t.coordIndex||0,c=t.properties,l;switch(n.type){case"FeatureCollection":r<0&&(r=n.features.length+r),c=c||n.features[r].properties,l=n.features[r].geometry;break;case"Feature":c=c||n.properties,l=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=n;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var f=l.coordinates;switch(l.type){case"Point":return Xt(f,c,t);case"MultiPoint":return i<0&&(i=f.length+i),Xt(f[i],c,t);case"LineString":return s<0&&(s=f.length+s),Xt(f[s],c,t);case"Polygon":return a<0&&(a=f.length+a),s<0&&(s=f[a].length+s),Xt(f[a][s],c,t);case"MultiLineString":return i<0&&(i=f.length+i),s<0&&(s=f[i].length+s),Xt(f[i][s],c,t);case"MultiPolygon":return i<0&&(i=f.length+i),a<0&&(a=f[i].length+a),s<0&&(s=f[i][a].length-s),Xt(f[i][a][s],c,t)}throw new Error("geojson is invalid")}const ga=Object.freeze(Object.defineProperty({__proto__:null,coordAll:ua,coordEach:je,coordReduce:oa,featureEach:Ve,featureReduce:aa,findPoint:da,findSegment:pa,flattenEach:he,flattenReduce:ca,geomEach:ar,geomReduce:la,lineEach:Mo,lineReduce:ha,propEach:wo,propReduce:sa,segmentEach:So,segmentReduce:fa},Symbol.toStringTag,{value:"Module"}));function va(n,t){if(t=t||{},!sr(t))throw new Error("options is invalid");var r=t.reverse||!1,i=t.mutate||!1;if(!n)throw new Error("<geojson> is required");if(typeof r!="boolean")throw new Error("<reverse> must be a boolean");if(typeof i!="boolean")throw new Error("<mutate> must be a boolean");i===!1&&(n=go(n));var a=[];switch(n.type){case"GeometryCollection":return ar(n,function(s){jr(s,r)}),n;case"FeatureCollection":return Ve(n,function(s){Ve(jr(s,r),function(c){a.push(c)})}),re(a)}return jr(n,r)}function jr(n,t){var r=n.type==="Feature"?n.geometry.type:n.type;switch(r){case"GeometryCollection":return ar(n,function(i){jr(i,t)}),n;case"LineString":return Fi(Nt(n),t),n;case"Polygon":return Ni(Nt(n),t),n;case"MultiLineString":return Nt(n).forEach(function(i){Fi(i,t)}),n;case"MultiPolygon":return Nt(n).forEach(function(i){Ni(i,t)}),n;case"Point":case"MultiPoint":return n}}function Fi(n,t){wn(n)===t&&n.reverse()}function Ni(n,t){wn(n[0])!==t&&n[0].reverse();for(var r=1;r<n.length;r++)wn(n[r])===t&&n[r].reverse()}function ya(n,t){var r=0,i=0,a=0,s=0,c=0,l=0,f=0,p=0,w=null,h=null,g=n[0],E=n[1],C=t.length;for(r;r<C;r++){i=0;var _=t[r].length-1,I=t[r];if(w=I[0],w[0]!==I[_][0]&&w[1]!==I[_][1])throw new Error("First and last coordinates in a ring must be the same");for(c=w[0]-g,l=w[1]-E,i;i<_;i++){if(h=I[i+1],p=h[1]-E,l<0&&p<0||l>0&&p>0){w=h,l=p,c=w[0]-g;continue}if(f=h[0]-n[0],p>0&&l<=0){if(s=c*p-f*l,s>0)a=a+1;else if(s===0)return 0}else if(l>0&&p<=0){if(s=c*p-f*l,s<0)a=a+1;else if(s===0)return 0}else if(p===0&&l<0){if(s=c*p-f*l,s===0)return 0}else if(l===0&&p<0){if(s=c*p-f*l,s===0)return 0}else if(l===0&&p===0){if(f<=0&&c>=0)return 0;if(c<=0&&f>=0)return 0}w=h,l=p,c=f}}return a%2!==0}const te=11102230246251565e-32,yt=134217729,ma=(3+8*te)*te;function bn(n,t,r,i,a){let s,c,l,f,p=t[0],w=i[0],h=0,g=0;w>p==w>-p?(s=p,p=t[++h]):(s=w,w=i[++g]);let E=0;if(h<n&&g<r)for(w>p==w>-p?(c=p+s,l=s-(c-p),p=t[++h]):(c=w+s,l=s-(c-w),w=i[++g]),s=c,l!==0&&(a[E++]=l);h<n&&g<r;)w>p==w>-p?(c=s+p,f=c-s,l=s-(c-f)+(p-f),p=t[++h]):(c=s+w,f=c-s,l=s-(c-f)+(w-f),w=i[++g]),s=c,l!==0&&(a[E++]=l);for(;h<n;)c=s+p,f=c-s,l=s-(c-f)+(p-f),p=t[++h],s=c,l!==0&&(a[E++]=l);for(;g<r;)c=s+w,f=c-s,l=s-(c-f)+(w-f),w=i[++g],s=c,l!==0&&(a[E++]=l);return(s!==0||E===0)&&(a[E++]=s),E}function ba(n,t){let r=t[0];for(let i=1;i<n;i++)r+=t[i];return r}function ur(n){return new Float64Array(n)}const Ea=(3+16*te)*te,_a=(2+12*te)*te,xa=(9+64*te)*te*te,Ae=ur(4),Ai=ur(8),Ri=ur(12),ki=ur(16),St=ur(4);function wa(n,t,r,i,a,s,c){let l,f,p,w,h,g,E,C,_,I,O,y,b,M,L,F,R,k;const Y=n-a,z=r-a,j=t-s,V=i-s;M=Y*V,g=yt*Y,E=g-(g-Y),C=Y-E,g=yt*V,_=g-(g-V),I=V-_,L=C*I-(M-E*_-C*_-E*I),F=j*z,g=yt*j,E=g-(g-j),C=j-E,g=yt*z,_=g-(g-z),I=z-_,R=C*I-(F-E*_-C*_-E*I),O=L-R,h=L-O,Ae[0]=L-(O+h)+(h-R),y=M+O,h=y-M,b=M-(y-h)+(O-h),O=b-F,h=b-O,Ae[1]=b-(O+h)+(h-F),k=y+O,h=k-y,Ae[2]=y-(k-h)+(O-h),Ae[3]=k;let J=ba(4,Ae),Z=_a*c;if(J>=Z||-J>=Z||(h=n-Y,l=n-(Y+h)+(h-a),h=r-z,p=r-(z+h)+(h-a),h=t-j,f=t-(j+h)+(h-s),h=i-V,w=i-(V+h)+(h-s),l===0&&f===0&&p===0&&w===0)||(Z=xa*c+ma*Math.abs(J),J+=Y*w+V*l-(j*p+z*f),J>=Z||-J>=Z))return J;M=l*V,g=yt*l,E=g-(g-l),C=l-E,g=yt*V,_=g-(g-V),I=V-_,L=C*I-(M-E*_-C*_-E*I),F=f*z,g=yt*f,E=g-(g-f),C=f-E,g=yt*z,_=g-(g-z),I=z-_,R=C*I-(F-E*_-C*_-E*I),O=L-R,h=L-O,St[0]=L-(O+h)+(h-R),y=M+O,h=y-M,b=M-(y-h)+(O-h),O=b-F,h=b-O,St[1]=b-(O+h)+(h-F),k=y+O,h=k-y,St[2]=y-(k-h)+(O-h),St[3]=k;const at=bn(4,Ae,4,St,Ai);M=Y*w,g=yt*Y,E=g-(g-Y),C=Y-E,g=yt*w,_=g-(g-w),I=w-_,L=C*I-(M-E*_-C*_-E*I),F=j*p,g=yt*j,E=g-(g-j),C=j-E,g=yt*p,_=g-(g-p),I=p-_,R=C*I-(F-E*_-C*_-E*I),O=L-R,h=L-O,St[0]=L-(O+h)+(h-R),y=M+O,h=y-M,b=M-(y-h)+(O-h),O=b-F,h=b-O,St[1]=b-(O+h)+(h-F),k=y+O,h=k-y,St[2]=y-(k-h)+(O-h),St[3]=k;const dt=bn(at,Ai,4,St,Ri);M=l*w,g=yt*l,E=g-(g-l),C=l-E,g=yt*w,_=g-(g-w),I=w-_,L=C*I-(M-E*_-C*_-E*I),F=f*p,g=yt*f,E=g-(g-f),C=f-E,g=yt*p,_=g-(g-p),I=p-_,R=C*I-(F-E*_-C*_-E*I),O=L-R,h=L-O,St[0]=L-(O+h)+(h-R),y=M+O,h=y-M,b=M-(y-h)+(O-h),O=b-F,h=b-O,St[1]=b-(O+h)+(h-F),k=y+O,h=k-y,St[2]=y-(k-h)+(O-h),St[3]=k;const vt=bn(dt,Ri,4,St,ki);return ki[vt-1]}function Sa(n,t,r,i,a,s){const c=(t-s)*(r-a),l=(n-a)*(i-s),f=c-l;if(c===0||l===0||c>0!=l>0)return f;const p=Math.abs(c+l);return Math.abs(f)>=Ea*p?f:-wa(n,t,r,i,a,s,p)}var Di=function(t,r,i,a,s){this.p1=t,this.p2=r,this.edgeType=i,this.originalIndex=a,this.polygonContourId=s,this.interiorRing=!1,this.minX=Math.min(t.p[0],r.p[0]),this.minY=Math.min(t.p[1],r.p[1]),this.maxX=Math.max(t.p[0],r.p[0]),this.maxY=Math.max(t.p[1],r.p[1]),this.intersectionPoints=[],this.nextEdge=null},Br=function(t){this.p=t},Ma=function(t,r){this.id=t,this.rawCoords=r};function Ca(n,t,r,i,a){for(var s=0,c=[],l=t.type==="Feature"?t.geometry:t,f=l.type==="LineString"?[l.coordinates]:l.coordinates,p=0,w=0;w<f.length;w++){for(var h=f[w].length-1,g=new Br(f[w][0]),E=null,C={nextEdge:null},_=0;_<h;_++){E=new Br(f[w][_+1]),g.nextPoint=E,E.prevPoint=g;var I=new Di(g,E,"polyline",p,null);i.push(I),C.nextEdge=I,I.prevEdge=C,a[0]=Math.min(a[0],g.p[0]),a[1]=Math.min(a[1],g.p[1]),a[2]=Math.max(a[2],g.p[0]),a[3]=Math.max(a[3],g.p[1]),g=E,p=p+1,C=I}a[0]=Math.min(a[0],f[w][h][0]),a[1]=Math.min(a[1],f[w][h][1]),a[2]=Math.max(a[2],f[w][h][0]),a[3]=Math.max(a[3],f[w][h][1])}for(var O=n.type==="Feature"?n.geometry:n,y=O.type==="Polygon"?[O.coordinates]:O.coordinates,b=y.length,M=0;M<b;M++)for(var L=y[M].length,F=0;F<L;F++){s=s+1;var R=y[M][F],k=R.length;c.push(new Ma(s,R));for(var Y=new Br(R[0]),z=Y,j=void 0,V=null,J={nextEdge:null,prevEdge:null},Z=null,at=1;at<k;at++)j=new Br(R[at]),z.nextPoint=j,j.prevPoint=z,V=new Di(z,j,"polygon",p,s),J.nextEdge=V,V.prevEdge=J,at===1&&(Z=V),F>0&&(V.interiorRing=!0),V.intersectPolylineBbox=Pa(V,a),r.push(V),z=j,p=p+1,J=V;V.nextEdge=Z,Z.prevEdge=V,j.nextPoint=Y.nextPoint,Y.prevPoint=j.prevPoint}return c}function Pa(n,t){return!(n.maxX<t[0]||n.minX>t[2]||n.maxY<t[1]||n.minY>t[3])}var Co=function(t,r,i,a){this.p=t,this.polylineEdge=r,this.polygonEdge=i,this.isHeadingIn=a,this.distanceFromPolylineEdgeStart=Ui(this.polylineEdge.p1.p,this.p),this.distanceFromPolygonEdgeStart=Ui(this.polygonEdge.p1.p,this.p),this.polygonEdge.intersectionPoints.push(this),this.polylineEdge.intersectionPoints.push(this),this.visitCount=0};Co.prototype.incrementVisitCount=function(){this.visitCount=this.visitCount+1};function Ui(n,t){var r=t[0]-n[0],i=t[1]-n[1];return r*=r,i*=i,Math.sqrt(r+i)}function Ia(n,t,r){var i,a,s,c=t.length,l=n.length;for(i=0;i<c;i++){var f=t[i];for(a=0;a<l;a++){var p=n[a];if(p.intersectPolylineBbox&&!(p.maxX<f.minX||p.minX>f.maxX)&&!(p.maxY<f.minY||p.minY>f.maxY)){var w=Ta(f,p);if(w!==null)for(s=0;s<w.length;s++){var h=Sa(p.p1.p[0],p.p1.p[1],p.p2.p[0],p.p2.p[1],f.p1.p[0],f.p1.p[1]),g=new Co(w[s],f,p,h>0);r.push(g)}}}}t.forEach(function(E){E.intersectionPoints.sort(function(C,_){return C.distanceFromPolylineEdgeStart-_.distanceFromPolylineEdgeStart})}),n.forEach(function(E){E.intersectionPoints.sort(function(C,_){return C.distanceFromPolygonEdgeStart-_.distanceFromPolygonEdgeStart})})}var Oa=1e-9;function Gr(n,t){return n[0]*t[1]-n[1]*t[0]}function Vr(n,t){return n[0]*t[0]+n[1]*t[1]}function we(n,t,r){return[n[0]+t*r[0],n[1]+t*r[1]]}function Ta(n,t,r){var i=[n.p2.p[0]-n.p1.p[0],n.p2.p[1]-n.p1.p[1]],a=[t.p2.p[0]-t.p1.p[0],t.p2.p[1]-t.p1.p[1]],s=[t.p1.p[0]-n.p1.p[0],t.p1.p[1]-n.p1.p[1]],c=Gr(i,a),l=c*c,f=Vr(i,i);if(l>0){var p=Gr(s,a)/c;if(p<0||p>1)return null;var w=Gr(s,i)/c;return w<0||w>1?null:p===0||p===1?r?null:[we(n.p1.p,p,i)]:w===0||w===1?r?null:[we(t.p1.p,w,a)]:[we(n.p1.p,p,i)]}var h=Vr(s,s);if(c=Gr(s,i),l=c*c,l>Oa*f*h)return null;var g=Vr(i,s)/f,E=g+Vr(i,a)/f,C=Math.min(g,E),_=Math.max(g,E);return C<=1&&_>=0?C===1?r?null:[we(n.p1.p,C>0?C:0,i)]:_===0?r?null:[we(n.p1.p,_<1?_:1,i)]:r&&C===0&&_===1?null:[we(n.p1.p,C>0?C:0,i),we(n.p1.p,_<1?_:1,i)]:null}function La(n,t){var r=va(n),i=[],a=[],s=[],c=[1/0,1/0,1/0,1/0],l=Ca(r,t,a,s,c);if(Ia(a,s,i),i.length===0)return n;var f={};l.forEach(function(Rt){return f[Rt.id]=0}),i.forEach(function(Rt){var Gt=Rt.polygonEdge.polygonContourId;f[Gt]=f[Gt]+1});for(var p=0,w=[],h=null,g=0;g<s.length;g++){var E=s[g];if(E.intersectionPoints.length>0){h=E.intersectionPoints[0];break}}for(var C=h,_={visitCount:1};h!==_&&!(p>i.length*2);){if(p=p++,_.visitCount>=2){for(var I=!1,O=0;O<i.length;O++){var y=i[O];if(y.visitCount<2){C=y,I=!0;break}}if(!I)break}C.visitCount=C.visitCount+1;var b=[];w.push(b),b.push(C.p),C.visitCount=C.visitCount+1;var M=Bi(C,b);_=M;var L=!1;if(M===_&&i.length===2)for(var F=0;F<i.length;F++){var R=i[F];R.visitCount<2&&(L=!0)}for(;M!==C||L;){var k=M.isHeadingIn?ka:Ra;M=k(M,b),M!==C&&(M=Bi(M,b)),L=!1}if(_.visitCount>=2){for(var Y=!1,z=0;z<i.length;z++){var j=i[z];if(j.visitCount<2){C=j,Y=!0;break}}Y&&(_=C)}C=_}for(var V=w.map(function(Rt){return[Rt]}),J=Object.keys(f),Z=0;Z<J.length;Z++){var at=J[Z],dt=f[at];if(dt===0){var vt=Fa(a,parseInt(at)),It=Na(vt,l);Aa(It,V)}}return{type:"Feature",properties:{},geometry:{type:"MultiPolygon",coordinates:V}}}function Fa(n,t){for(var r=0;r<n.length;r++){var i=n[r];if(i.polygonContourId===t)return i}}function Na(n,t){var r=t.find(function(i){return i.id===n.polygonContourId});return r.rawCoords}function Aa(n,t){for(var r=0;r<t.length;r++){var i=t[r];if(ya(n[0],[i[0]])){i.push(n);return}}t.push([n])}function Bi(n,t){var r=n.polygonEdge;if(r.intersectionPoints.length>1){var i=r.intersectionPoints[r.intersectionPoints.length-1];if(i!==n){var a=kn(n,r.intersectionPoints),s=r.intersectionPoints[a+1];return t.push(s.p),s.incrementVisitCount(),s}}for(var c=!0;c;){if(t.push(r.p2.p),r=r.nextEdge,r===null)return n;r.intersectionPoints.length>0&&(c=!1)}return r.intersectionPoints[0].incrementVisitCount(),t.push(r.intersectionPoints[0].p),r.intersectionPoints[0]}function kn(n,t){for(var r=0;r<t.length;r++){var i=t[r];if(i===n)return r}return null}function Ra(n,t){var r=n.polylineEdge;if(r.intersectionPoints.length===2){var i=r.intersectionPoints[r.intersectionPoints.length-1];if(i===n){var a=r.intersectionPoints[0];return t.push(a.p),a.incrementVisitCount(),a}else return t.push(i.p),i.incrementVisitCount(),i}else if(r.intersectionPoints.length>2){var s=r.intersectionPoints[0];if(s!==n){var c=kn(n,r.intersectionPoints),l=r.intersectionPoints[c-1];return t.push(l.p),l.incrementVisitCount(),l}}for(var f=!0;f;){if(t.push(r.p1.p),r=r.prevEdge,r.originalIndex===void 0)return n;r.intersectionPoints.length>0&&(f=!1)}if(r.originalIndex===void 0)return n;var p=r.intersectionPoints[r.intersectionPoints.length-1];return p.incrementVisitCount(),t.push(p.p),p}function ka(n,t){var r=n.polylineEdge;if(r.intersectionPoints.length>1){var i=r.intersectionPoints[r.intersectionPoints.length-1];if(i!==n){var a=kn(n,r.intersectionPoints),s=r.intersectionPoints[a+1];return t.push(s.p),s.incrementVisitCount(),s}}for(var c=!0;c;){if(t.push(r.p2.p),r=r.nextEdge,r===null)return n;r.intersectionPoints.length>0&&(c=!1)}if(r===void 0)return n;var l=r.intersectionPoints[0];return l.incrementVisitCount(),t.push(l.p),l}function Gi(n){if(!n)throw new Error("geojson is required");var t=[];return he(n,function(r){Da(r,t)}),re(t)}function Da(n,t){var r=[],i=n.geometry;if(i!==null){switch(i.type){case"Polygon":r=Nt(i);break;case"LineString":r=[Nt(i)]}r.forEach(function(a){var s=Ua(a,n.properties);s.forEach(function(c){c.id=t.length,t.push(c)})})}}function Ua(n,t){var r=[];return n.reduce(function(i,a){var s=Pt([i,a],t);return s.bbox=Ba(i,a),r.push(s),a}),r}function Ba(n,t){var r=n[0],i=n[1],a=t[0],s=t[1],c=r<a?r:a,l=i<s?i:s,f=r>a?r:a,p=i>s?i:s;return[c,l,f,p]}var Dn={exports:{}},Po={exports:{}};(function(n,t){(function(r,i){n.exports=i()})(Ue,function(){function r(y,b,M,L,F){(function R(k,Y,z,j,V){for(;j>z;){if(j-z>600){var J=j-z+1,Z=Y-z+1,at=Math.log(J),dt=.5*Math.exp(2*at/3),vt=.5*Math.sqrt(at*dt*(J-dt)/J)*(Z-J/2<0?-1:1),It=Math.max(z,Math.floor(Y-Z*dt/J+vt)),Rt=Math.min(j,Math.floor(Y+(J-Z)*dt/J+vt));R(k,Y,It,Rt,V)}var Gt=k[Y],$t=z,Et=j;for(i(k,z,Y),V(k[j],Gt)>0&&i(k,z,j);$t<Et;){for(i(k,$t,Et),$t++,Et--;V(k[$t],Gt)<0;)$t++;for(;V(k[Et],Gt)>0;)Et--}V(k[z],Gt)===0?i(k,z,Et):i(k,++Et,j),Et<=Y&&(z=Et+1),Y<=Et&&(j=Et-1)}})(y,b,M||0,L||y.length-1,F||a)}function i(y,b,M){var L=y[b];y[b]=y[M],y[M]=L}function a(y,b){return y<b?-1:y>b?1:0}var s=function(y){y===void 0&&(y=9),this._maxEntries=Math.max(4,y),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function c(y,b,M){if(!M)return b.indexOf(y);for(var L=0;L<b.length;L++)if(M(y,b[L]))return L;return-1}function l(y,b){f(y,0,y.children.length,b,y)}function f(y,b,M,L,F){F||(F=I(null)),F.minX=1/0,F.minY=1/0,F.maxX=-1/0,F.maxY=-1/0;for(var R=b;R<M;R++){var k=y.children[R];p(F,y.leaf?L(k):k)}return F}function p(y,b){return y.minX=Math.min(y.minX,b.minX),y.minY=Math.min(y.minY,b.minY),y.maxX=Math.max(y.maxX,b.maxX),y.maxY=Math.max(y.maxY,b.maxY),y}function w(y,b){return y.minX-b.minX}function h(y,b){return y.minY-b.minY}function g(y){return(y.maxX-y.minX)*(y.maxY-y.minY)}function E(y){return y.maxX-y.minX+(y.maxY-y.minY)}function C(y,b){return y.minX<=b.minX&&y.minY<=b.minY&&b.maxX<=y.maxX&&b.maxY<=y.maxY}function _(y,b){return b.minX<=y.maxX&&b.minY<=y.maxY&&b.maxX>=y.minX&&b.maxY>=y.minY}function I(y){return{children:y,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function O(y,b,M,L,F){for(var R=[b,M];R.length;)if(!((M=R.pop())-(b=R.pop())<=L)){var k=b+Math.ceil((M-b)/L/2)*L;r(y,k,b,M,F),R.push(b,k,k,M)}}return s.prototype.all=function(){return this._all(this.data,[])},s.prototype.search=function(y){var b=this.data,M=[];if(!_(y,b))return M;for(var L=this.toBBox,F=[];b;){for(var R=0;R<b.children.length;R++){var k=b.children[R],Y=b.leaf?L(k):k;_(y,Y)&&(b.leaf?M.push(k):C(y,Y)?this._all(k,M):F.push(k))}b=F.pop()}return M},s.prototype.collides=function(y){var b=this.data;if(!_(y,b))return!1;for(var M=[];b;){for(var L=0;L<b.children.length;L++){var F=b.children[L],R=b.leaf?this.toBBox(F):F;if(_(y,R)){if(b.leaf||C(y,R))return!0;M.push(F)}}b=M.pop()}return!1},s.prototype.load=function(y){if(!y||!y.length)return this;if(y.length<this._minEntries){for(var b=0;b<y.length;b++)this.insert(y[b]);return this}var M=this._build(y.slice(),0,y.length-1,0);if(this.data.children.length)if(this.data.height===M.height)this._splitRoot(this.data,M);else{if(this.data.height<M.height){var L=this.data;this.data=M,M=L}this._insert(M,this.data.height-M.height-1,!0)}else this.data=M;return this},s.prototype.insert=function(y){return y&&this._insert(y,this.data.height-1),this},s.prototype.clear=function(){return this.data=I([]),this},s.prototype.remove=function(y,b){if(!y)return this;for(var M,L,F,R=this.data,k=this.toBBox(y),Y=[],z=[];R||Y.length;){if(R||(R=Y.pop(),L=Y[Y.length-1],M=z.pop(),F=!0),R.leaf){var j=c(y,R.children,b);if(j!==-1)return R.children.splice(j,1),Y.push(R),this._condense(Y),this}F||R.leaf||!C(R,k)?L?(M++,R=L.children[M],F=!1):R=null:(Y.push(R),z.push(M),M=0,L=R,R=R.children[0])}return this},s.prototype.toBBox=function(y){return y},s.prototype.compareMinX=function(y,b){return y.minX-b.minX},s.prototype.compareMinY=function(y,b){return y.minY-b.minY},s.prototype.toJSON=function(){return this.data},s.prototype.fromJSON=function(y){return this.data=y,this},s.prototype._all=function(y,b){for(var M=[];y;)y.leaf?b.push.apply(b,y.children):M.push.apply(M,y.children),y=M.pop();return b},s.prototype._build=function(y,b,M,L){var F,R=M-b+1,k=this._maxEntries;if(R<=k)return l(F=I(y.slice(b,M+1)),this.toBBox),F;L||(L=Math.ceil(Math.log(R)/Math.log(k)),k=Math.ceil(R/Math.pow(k,L-1))),(F=I([])).leaf=!1,F.height=L;var Y=Math.ceil(R/k),z=Y*Math.ceil(Math.sqrt(k));O(y,b,M,z,this.compareMinX);for(var j=b;j<=M;j+=z){var V=Math.min(j+z-1,M);O(y,j,V,Y,this.compareMinY);for(var J=j;J<=V;J+=Y){var Z=Math.min(J+Y-1,V);F.children.push(this._build(y,J,Z,L-1))}}return l(F,this.toBBox),F},s.prototype._chooseSubtree=function(y,b,M,L){for(;L.push(b),!b.leaf&&L.length-1!==M;){for(var F=1/0,R=1/0,k=void 0,Y=0;Y<b.children.length;Y++){var z=b.children[Y],j=g(z),V=(J=y,Z=z,(Math.max(Z.maxX,J.maxX)-Math.min(Z.minX,J.minX))*(Math.max(Z.maxY,J.maxY)-Math.min(Z.minY,J.minY))-j);V<R?(R=V,F=j<F?j:F,k=z):V===R&&j<F&&(F=j,k=z)}b=k||b.children[0]}var J,Z;return b},s.prototype._insert=function(y,b,M){var L=M?y:this.toBBox(y),F=[],R=this._chooseSubtree(L,this.data,b,F);for(R.children.push(y),p(R,L);b>=0&&F[b].children.length>this._maxEntries;)this._split(F,b),b--;this._adjustParentBBoxes(L,F,b)},s.prototype._split=function(y,b){var M=y[b],L=M.children.length,F=this._minEntries;this._chooseSplitAxis(M,F,L);var R=this._chooseSplitIndex(M,F,L),k=I(M.children.splice(R,M.children.length-R));k.height=M.height,k.leaf=M.leaf,l(M,this.toBBox),l(k,this.toBBox),b?y[b-1].children.push(k):this._splitRoot(M,k)},s.prototype._splitRoot=function(y,b){this.data=I([y,b]),this.data.height=y.height+1,this.data.leaf=!1,l(this.data,this.toBBox)},s.prototype._chooseSplitIndex=function(y,b,M){for(var L,F,R,k,Y,z,j,V=1/0,J=1/0,Z=b;Z<=M-b;Z++){var at=f(y,0,Z,this.toBBox),dt=f(y,Z,M,this.toBBox),vt=(F=at,R=dt,k=void 0,Y=void 0,z=void 0,j=void 0,k=Math.max(F.minX,R.minX),Y=Math.max(F.minY,R.minY),z=Math.min(F.maxX,R.maxX),j=Math.min(F.maxY,R.maxY),Math.max(0,z-k)*Math.max(0,j-Y)),It=g(at)+g(dt);vt<V?(V=vt,L=Z,J=It<J?It:J):vt===V&&It<J&&(J=It,L=Z)}return L||M-b},s.prototype._chooseSplitAxis=function(y,b,M){var L=y.leaf?this.compareMinX:w,F=y.leaf?this.compareMinY:h;this._allDistMargin(y,b,M,L)<this._allDistMargin(y,b,M,F)&&y.children.sort(L)},s.prototype._allDistMargin=function(y,b,M,L){y.children.sort(L);for(var F=this.toBBox,R=f(y,0,b,F),k=f(y,M-b,M,F),Y=E(R)+E(k),z=b;z<M-b;z++){var j=y.children[z];p(R,y.leaf?F(j):j),Y+=E(R)}for(var V=M-b-1;V>=b;V--){var J=y.children[V];p(k,y.leaf?F(J):J),Y+=E(k)}return Y},s.prototype._adjustParentBBoxes=function(y,b,M){for(var L=M;L>=0;L--)p(b[L],y)},s.prototype._condense=function(y){for(var b=y.length-1,M=void 0;b>=0;b--)y[b].children.length===0?b>0?(M=y[b-1].children).splice(M.indexOf(y[b]),1):this.clear():l(y[b],this.toBBox)},s})})(Po);var Ga=Po.exports;const Va=Fn(ra),Ya=Fn(ga);function $r(n){var t=[1/0,1/0,-1/0,-1/0];return je(n,function(r){t[0]>r[0]&&(t[0]=r[0]),t[1]>r[1]&&(t[1]=r[1]),t[2]<r[0]&&(t[2]=r[0]),t[3]<r[1]&&(t[3]=r[1])}),t}$r.default=$r;const ja=Object.freeze(Object.defineProperty({__proto__:null,default:$r},Symbol.toStringTag,{value:"Module"})),za=Fn(ja);var zt=Ga,Io=Va,Oo=Ya,Re=za.default,Xa=Oo.featureEach;Oo.coordEach;Io.polygon;var Vi=Io.featureCollection;function To(n){var t=new zt(n);return t.insert=function(r){if(r.type!=="Feature")throw new Error("invalid feature");return r.bbox=r.bbox?r.bbox:Re(r),zt.prototype.insert.call(this,r)},t.load=function(r){var i=[];return Array.isArray(r)?r.forEach(function(a){if(a.type!=="Feature")throw new Error("invalid features");a.bbox=a.bbox?a.bbox:Re(a),i.push(a)}):Xa(r,function(a){if(a.type!=="Feature")throw new Error("invalid features");a.bbox=a.bbox?a.bbox:Re(a),i.push(a)}),zt.prototype.load.call(this,i)},t.remove=function(r,i){if(r.type!=="Feature")throw new Error("invalid feature");return r.bbox=r.bbox?r.bbox:Re(r),zt.prototype.remove.call(this,r,i)},t.clear=function(){return zt.prototype.clear.call(this)},t.search=function(r){var i=zt.prototype.search.call(this,this.toBBox(r));return Vi(i)},t.collides=function(r){return zt.prototype.collides.call(this,this.toBBox(r))},t.all=function(){var r=zt.prototype.all.call(this);return Vi(r)},t.toJSON=function(){return zt.prototype.toJSON.call(this)},t.fromJSON=function(r){return zt.prototype.fromJSON.call(this,r)},t.toBBox=function(r){var i;if(r.bbox)i=r.bbox;else if(Array.isArray(r)&&r.length===4)i=r;else if(Array.isArray(r)&&r.length===6)i=[r[0],r[1],r[3],r[4]];else if(r.type==="Feature")i=Re(r);else if(r.type==="FeatureCollection")i=Re(r);else throw new Error("invalid geojson");return{minX:i[0],minY:i[1],maxX:i[2],maxY:i[3]}},t}Dn.exports=To;Dn.exports.default=To;var $a=Dn.exports;const Ja=co($a);function Hr(n,t){var r={},i=[];if(n.type==="LineString"&&(n=At(n)),t.type==="LineString"&&(t=At(t)),n.type==="Feature"&&t.type==="Feature"&&n.geometry!==null&&t.geometry!==null&&n.geometry.type==="LineString"&&t.geometry.type==="LineString"&&n.geometry.coordinates.length===2&&t.geometry.coordinates.length===2){var a=Yi(n,t);return a&&i.push(a),re(i)}var s=Ja();return s.load(Gi(t)),Ve(Gi(n),function(c){Ve(s.search(c),function(l){var f=Yi(c,l);if(f){var p=Nt(f).join(",");r[p]||(r[p]=!0,i.push(f))}})}),re(i)}function Yi(n,t){var r=Nt(n),i=Nt(t);if(r.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(i.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var a=r[0][0],s=r[0][1],c=r[1][0],l=r[1][1],f=i[0][0],p=i[0][1],w=i[1][0],h=i[1][1],g=(h-p)*(c-a)-(w-f)*(l-s),E=(w-f)*(s-p)-(h-p)*(a-f),C=(c-a)*(s-p)-(l-s)*(a-f);if(g===0)return null;var _=E/g,I=C/g;if(_>=0&&_<=1&&I>=0&&I<=1){var O=a+_*(c-a),y=s+_*(l-s);return Xt([O,y])}return null}function nr(n,t,r){if(r===void 0&&(r={}),!n)throw new Error("point is required");if(!t)throw new Error("polygon is required");var i=na(n),a=Se(t),s=a.type,c=t.bbox,l=a.coordinates;if(c&&qa(i,c)===!1)return!1;s==="Polygon"&&(l=[l]);for(var f=!1,p=0;p<l.length&&!f;p++)if(ji(i,l[p][0],r.ignoreBoundary)){for(var w=!1,h=1;h<l[p].length&&!w;)ji(i,l[p][h],!r.ignoreBoundary)&&(w=!0),h++;w||(f=!0)}return f}function ji(n,t,r){var i=!1;t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]&&(t=t.slice(0,t.length-1));for(var a=0,s=t.length-1;a<t.length;s=a++){var c=t[a][0],l=t[a][1],f=t[s][0],p=t[s][1],w=n[1]*(c-f)+l*(f-n[0])+p*(n[0]-c)===0&&(c-n[0])*(f-n[0])<=0&&(l-n[1])*(p-n[1])<=0;if(w)return!r;var h=l>n[1]!=p>n[1]&&n[0]<(f-c)*(n[1]-l)/(p-l)+c;h&&(i=!i)}return i}function qa(n,t){return t[0]<=n[0]&&t[1]<=n[1]&&t[2]>=n[0]&&t[3]>=n[1]}function Sn(n,t){t===void 0&&(t={});var r=Se(n);switch(!t.properties&&n.type==="Feature"&&(t.properties=n.properties),r.type){case"Polygon":return Za(r,t);case"MultiPolygon":return Wa(r,t);default:throw new Error("invalid poly")}}function Za(n,t){t===void 0&&(t={});var r=Se(n),i=r.coordinates,a=t.properties?t.properties:n.type==="Feature"?n.properties:{};return Lo(i,a)}function Wa(n,t){t===void 0&&(t={});var r=Se(n),i=r.coordinates,a=t.properties?t.properties:n.type==="Feature"?n.properties:{},s=[];return i.forEach(function(c){s.push(Lo(c,a))}),re(s)}function Lo(n,t){return n.length>1?Wr(n,t):Pt(n[0],t)}function Fo(n,t){var r=!0;return he(n,function(i){he(t,function(a){if(r===!1)return!1;r=Qa(i.geometry,a.geometry)})}),r}function Qa(n,t){switch(n.type){case"Point":switch(t.type){case"Point":return!eu(n.coordinates,t.coordinates);case"LineString":return!zi(t,n);case"Polygon":return!nr(n,t)}break;case"LineString":switch(t.type){case"Point":return!zi(n,t);case"LineString":return!Ha(n,t);case"Polygon":return!Xi(t,n)}break;case"Polygon":switch(t.type){case"Point":return!nr(t,n);case"LineString":return!Xi(n,t);case"Polygon":return!Ka(t,n)}}return!1}function zi(n,t){for(var r=0;r<n.coordinates.length-1;r++)if(tu(n.coordinates[r],n.coordinates[r+1],t.coordinates))return!0;return!1}function Ha(n,t){var r=Hr(n,t);return r.features.length>0}function Xi(n,t){for(var r=0,i=t.coordinates;r<i.length;r++){var a=i[r];if(nr(a,n))return!0}var s=Hr(t,Sn(n));return s.features.length>0}function Ka(n,t){for(var r=0,i=n.coordinates[0];r<i.length;r++){var a=i[r];if(nr(a,t))return!0}for(var s=0,c=t.coordinates[0];s<c.length;s++){var l=c[s];if(nr(l,n))return!0}var f=Hr(Sn(n),Sn(t));return f.features.length>0}function tu(n,t,r){var i=r[0]-n[0],a=r[1]-n[1],s=t[0]-n[0],c=t[1]-n[1],l=i*c-a*s;return l!==0?!1:Math.abs(s)>=Math.abs(c)?s>0?n[0]<=r[0]&&r[0]<=t[0]:t[0]<=r[0]&&r[0]<=n[0]:c>0?n[1]<=r[1]&&r[1]<=t[1]:t[1]<=r[1]&&r[1]<=n[1]}function eu(n,t){return n[0]===t[0]&&n[1]===t[1]}function Jr(n){var t=n[0],r=n[1];return[r[0]-t[0],r[1]-t[1]]}function Mn(n,t){return n[0]*t[1]-t[0]*n[1]}function ru(n,t){return[n[0]+t[0],n[1]+t[1]]}function nu(n,t){return[n[0]-t[0],n[1]-t[1]]}function iu(n,t){return[n*t[0],n*t[1]]}function ou(n,t){var r=n[0],i=Jr(n),a=t[0],s=Jr(t),c=Mn(i,s),l=nu(a,r),f=Mn(l,s),p=f/c,w=ru(r,iu(p,i));return w}function su(n,t){var r=Jr(n),i=Jr(t);return Mn(r,i)===0}function au(n,t){return su(n,t)?!1:ou(n,t)}function $i(n,t,r){if(r=r||{},!sr(r))throw new Error("options is invalid");var i=r.units;if(!n)throw new Error("geojson is required");if(t==null||isNaN(t))throw new Error("distance is required");var a=ia(n),s=n.properties;switch(a){case"LineString":return Ji(n,t,i);case"MultiLineString":var c=[];return he(n,function(l){c.push(Ji(l,t,i).geometry.coordinates)}),Wr(c,s);default:throw new Error("geometry "+a+" is not supported")}}function Ji(n,t,r){var i=[],a=_o(t,r),s=Nt(n),c=[];return s.forEach(function(l,f){if(f!==s.length-1){var p=uu(l,s[f+1],a);if(i.push(p),f>0){var w=i[f-1],h=au(p,w);h!==!1&&(w[1]=h,p[0]=h),c.push(w[0]),f===s.length-2&&(c.push(p[0]),c.push(p[1]))}s.length===2&&(c.push(p[0]),c.push(p[1]))}}),Pt(c,n.properties)}function uu(n,t,r){var i=Math.sqrt((n[0]-t[0])*(n[0]-t[0])+(n[1]-t[1])*(n[1]-t[1])),a=n[0]+r*(t[1]-n[1])/i,s=t[0]+r*(t[1]-n[1])/i,c=n[1]+r*(n[0]-t[0])/i,l=t[1]+r*(n[0]-t[0])/i;return[[a,c],[s,l]]}function lu(n,t){t===void 0&&(t={});var r,i,a,s=t.properties,c=(r=t.autoComplete)!==null&&r!==void 0?r:!0,l=(i=t.orderCoords)!==null&&i!==void 0?i:!0,f=(a=t.mutate)!==null&&a!==void 0?a:!1;switch(f||(n=go(n)),n.type){case"FeatureCollection":var p=[];return n.features.forEach(function(w){p.push(Nt(qi(w,{},c,l)))}),Qr(p,s);default:return qi(n,s,c,l)}}function qi(n,t,r,i){t=t||(n.type==="Feature"?n.properties:{});var a=Se(n),s=a.coordinates,c=a.type;if(!s.length)throw new Error("line must contain coordinates");switch(c){case"LineString":return r&&(s=Zi(s)),Ge([s],t);case"MultiLineString":var l=[],f=0;return s.forEach(function(p){if(r&&(p=Zi(p)),i){var w=cu($r(Pt(p)));w>f?(l.unshift(p),f=w):l.push(p)}else l.push(p)}),Ge(l,t);default:throw new Error("geometry type "+c+" is not supported")}}function Zi(n){var t=n[0],r=t[0],i=t[1],a=n[n.length-1],s=a[0],c=a[1];return(r!==s||i!==c)&&n.push(t),n}function cu(n){var t=n[0],r=n[1],i=n[2],a=n[3];return Math.abs(t-i)*Math.abs(r-a)}/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function fu(n,t){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,a,s,c;return c={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function l(p){return function(w){return f([p,w])}}function f(p){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,a&&(s=p[0]&2?a.return:p[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,p[1])).done)return s;switch(a=0,s&&(p=[p[0]&2,s.value]),p[0]){case 0:case 1:s=p;break;case 4:return r.label++,{value:p[1],done:!1};case 5:r.label++,a=p[1],p=[0];continue;case 7:p=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(p[0]===6||p[0]===2)){r=0;continue}if(p[0]===3&&(!s||p[1]>s[0]&&p[1]<s[3])){r.label=p[1];break}if(p[0]===6&&r.label<s[1]){r.label=s[1],s=p;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(p);break}s[2]&&r.ops.pop(),r.trys.pop();continue}p=t.call(n,r)}catch(w){p=[6,w],a=0}finally{i=s=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}}var pe=function(){function n(t,r){this.next=null,this.key=t,this.data=r,this.left=null,this.right=null}return n}();function hu(n,t){return n>t?1:n<t?-1:0}function le(n,t,r){for(var i=new pe(null,null),a=i,s=i;;){var c=r(n,t.key);if(c<0){if(t.left===null)break;if(r(n,t.left.key)<0){var l=t.left;if(t.left=l.right,l.right=t,t=l,t.left===null)break}s.left=t,s=t,t=t.left}else if(c>0){if(t.right===null)break;if(r(n,t.right.key)>0){var l=t.right;if(t.right=l.left,l.left=t,t=l,t.right===null)break}a.right=t,a=t,t=t.right}else break}return a.right=t.left,s.left=t.right,t.left=i.right,t.right=i.left,t}function En(n,t,r,i){var a=new pe(n,t);if(r===null)return a.left=a.right=null,a;r=le(n,r,i);var s=i(n,r.key);return s<0?(a.left=r.left,a.right=r,r.left=null):s>=0&&(a.right=r.right,a.left=r,r.right=null),a}function Wi(n,t,r){var i=null,a=null;if(t){t=le(n,t,r);var s=r(t.key,n);s===0?(i=t.left,a=t.right):s<0?(a=t.right,t.right=null,i=t):(i=t.left,t.left=null,a=t)}return{left:i,right:a}}function pu(n,t,r){return t===null?n:(n===null||(t=le(n.key,t,r),t.left=n),t)}function Cn(n,t,r,i,a){if(n){i(""+t+(r?" ":" ")+a(n)+`
`);var s=t+(r?"    ":"   ");n.left&&Cn(n.left,s,!1,i,a),n.right&&Cn(n.right,s,!0,i,a)}}var Un=function(){function n(t){t===void 0&&(t=hu),this._root=null,this._size=0,this._comparator=t}return n.prototype.insert=function(t,r){return this._size++,this._root=En(t,r,this._root,this._comparator)},n.prototype.add=function(t,r){var i=new pe(t,r);this._root===null&&(i.left=i.right=null,this._size++,this._root=i);var a=this._comparator,s=le(t,this._root,a),c=a(t,s.key);return c===0?this._root=s:(c<0?(i.left=s.left,i.right=s,s.left=null):c>0&&(i.right=s.right,i.left=s,s.right=null),this._size++,this._root=i),this._root},n.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},n.prototype._remove=function(t,r,i){var a;if(r===null)return null;r=le(t,r,i);var s=i(t,r.key);return s===0?(r.left===null?a=r.right:(a=le(t,r.left,i),a.right=r.right),this._size--,a):r},n.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=le(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},n.prototype.findStatic=function(t){for(var r=this._root,i=this._comparator;r;){var a=i(t,r.key);if(a===0)return r;a<0?r=r.left:r=r.right}return null},n.prototype.find=function(t){return this._root&&(this._root=le(t,this._root,this._comparator),this._comparator(t,this._root.key)!==0)?null:this._root},n.prototype.contains=function(t){for(var r=this._root,i=this._comparator;r;){var a=i(t,r.key);if(a===0)return!0;a<0?r=r.left:r=r.right}return!1},n.prototype.forEach=function(t,r){for(var i=this._root,a=[],s=!1;!s;)i!==null?(a.push(i),i=i.left):a.length!==0?(i=a.pop(),t.call(r,i),i=i.right):s=!0;return this},n.prototype.range=function(t,r,i,a){for(var s=[],c=this._comparator,l=this._root,f;s.length!==0||l;)if(l)s.push(l),l=l.left;else{if(l=s.pop(),f=c(l.key,r),f>0)break;if(c(l.key,t)>=0&&i.call(a,l))return this;l=l.right}return this},n.prototype.keys=function(){var t=[];return this.forEach(function(r){var i=r.key;return t.push(i)}),t},n.prototype.values=function(){var t=[];return this.forEach(function(r){var i=r.data;return t.push(i)}),t},n.prototype.min=function(){return this._root?this.minNode(this._root).key:null},n.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},n.prototype.minNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.left;)t=t.left;return t},n.prototype.maxNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.right;)t=t.right;return t},n.prototype.at=function(t){for(var r=this._root,i=!1,a=0,s=[];!i;)if(r)s.push(r),r=r.left;else if(s.length>0){if(r=s.pop(),a===t)return r;a++,r=r.right}else i=!0;return null},n.prototype.next=function(t){var r=this._root,i=null;if(t.right){for(i=t.right;i.left;)i=i.left;return i}for(var a=this._comparator;r;){var s=a(t.key,r.key);if(s===0)break;s<0?(i=r,r=r.left):r=r.right}return i},n.prototype.prev=function(t){var r=this._root,i=null;if(t.left!==null){for(i=t.left;i.right;)i=i.right;return i}for(var a=this._comparator;r;){var s=a(t.key,r.key);if(s===0)break;s<0?r=r.left:(i=r,r=r.right)}return i},n.prototype.clear=function(){return this._root=null,this._size=0,this},n.prototype.toList=function(){return gu(this._root)},n.prototype.load=function(t,r,i){r===void 0&&(r=[]),i===void 0&&(i=!1);var a=t.length,s=this._comparator;if(i&&On(t,r,0,a-1,s),this._root===null)this._root=Pn(t,r,0,a),this._size=a;else{var c=vu(this.toList(),du(t,r),s);a=this._size+a,this._root=In({head:c},0,a)}return this},n.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(n.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),n.prototype.toString=function(t){t===void 0&&(t=function(i){return String(i.key)});var r=[];return Cn(this._root,"",!0,function(i){return r.push(i)},t),r.join("")},n.prototype.update=function(t,r,i){var a=this._comparator,s=Wi(t,this._root,a),c=s.left,l=s.right;a(t,r)<0?l=En(r,i,l,a):c=En(r,i,c,a),this._root=pu(c,l,a)},n.prototype.split=function(t){return Wi(t,this._root,this._comparator)},n.prototype[Symbol.iterator]=function(){var t,r,i;return fu(this,function(a){switch(a.label){case 0:t=this._root,r=[],i=!1,a.label=1;case 1:return i?[3,6]:t===null?[3,2]:(r.push(t),t=t.left,[3,5]);case 2:return r.length===0?[3,4]:(t=r.pop(),[4,t]);case 3:return a.sent(),t=t.right,[3,5];case 4:i=!0,a.label=5;case 5:return[3,1];case 6:return[2]}})},n}();function Pn(n,t,r,i){var a=i-r;if(a>0){var s=r+Math.floor(a/2),c=n[s],l=t[s],f=new pe(c,l);return f.left=Pn(n,t,r,s),f.right=Pn(n,t,s+1,i),f}return null}function du(n,t){for(var r=new pe(null,null),i=r,a=0;a<n.length;a++)i=i.next=new pe(n[a],t[a]);return i.next=null,r.next}function gu(n){for(var t=n,r=[],i=!1,a=new pe(null,null),s=a;!i;)t?(r.push(t),t=t.left):r.length>0?(t=s=s.next=r.pop(),t=t.right):i=!0;return s.next=null,a.next}function In(n,t,r){var i=r-t;if(i>0){var a=t+Math.floor(i/2),s=In(n,t,a),c=n.head;return c.left=s,n.head=n.head.next,c.right=In(n,a+1,r),c}return null}function vu(n,t,r){for(var i=new pe(null,null),a=i,s=n,c=t;s!==null&&c!==null;)r(s.key,c.key)<0?(a.next=s,s=s.next):(a.next=c,c=c.next),a=a.next;return s!==null?a.next=s:c!==null&&(a.next=c),i.next}function On(n,t,r,i,a){if(!(r>=i)){for(var s=n[r+i>>1],c=r-1,l=i+1;;){do c++;while(a(n[c],s)<0);do l--;while(a(n[l],s)>0);if(c>=l)break;var f=n[c];n[c]=n[l],n[l]=f,f=t[c],t[c]=t[l],t[l]=f}On(n,t,r,l,a),On(n,t,l+1,i,a)}}const ee=11102230246251565e-32,mt=134217729,yu=(3+8*ee)*ee;function _n(n,t,r,i,a){let s,c,l,f,p=t[0],w=i[0],h=0,g=0;w>p==w>-p?(s=p,p=t[++h]):(s=w,w=i[++g]);let E=0;if(h<n&&g<r)for(w>p==w>-p?(c=p+s,l=s-(c-p),p=t[++h]):(c=w+s,l=s-(c-w),w=i[++g]),s=c,l!==0&&(a[E++]=l);h<n&&g<r;)w>p==w>-p?(c=s+p,f=c-s,l=s-(c-f)+(p-f),p=t[++h]):(c=s+w,f=c-s,l=s-(c-f)+(w-f),w=i[++g]),s=c,l!==0&&(a[E++]=l);for(;h<n;)c=s+p,f=c-s,l=s-(c-f)+(p-f),p=t[++h],s=c,l!==0&&(a[E++]=l);for(;g<r;)c=s+w,f=c-s,l=s-(c-f)+(w-f),w=i[++g],s=c,l!==0&&(a[E++]=l);return(s!==0||E===0)&&(a[E++]=s),E}function mu(n,t){let r=t[0];for(let i=1;i<n;i++)r+=t[i];return r}function lr(n){return new Float64Array(n)}const bu=(3+16*ee)*ee,Eu=(2+12*ee)*ee,_u=(9+64*ee)*ee*ee,ke=lr(4),Qi=lr(8),Hi=lr(12),Ki=lr(16),Mt=lr(4);function xu(n,t,r,i,a,s,c){let l,f,p,w,h,g,E,C,_,I,O,y,b,M,L,F,R,k;const Y=n-a,z=r-a,j=t-s,V=i-s;M=Y*V,g=mt*Y,E=g-(g-Y),C=Y-E,g=mt*V,_=g-(g-V),I=V-_,L=C*I-(M-E*_-C*_-E*I),F=j*z,g=mt*j,E=g-(g-j),C=j-E,g=mt*z,_=g-(g-z),I=z-_,R=C*I-(F-E*_-C*_-E*I),O=L-R,h=L-O,ke[0]=L-(O+h)+(h-R),y=M+O,h=y-M,b=M-(y-h)+(O-h),O=b-F,h=b-O,ke[1]=b-(O+h)+(h-F),k=y+O,h=k-y,ke[2]=y-(k-h)+(O-h),ke[3]=k;let J=mu(4,ke),Z=Eu*c;if(J>=Z||-J>=Z||(h=n-Y,l=n-(Y+h)+(h-a),h=r-z,p=r-(z+h)+(h-a),h=t-j,f=t-(j+h)+(h-s),h=i-V,w=i-(V+h)+(h-s),l===0&&f===0&&p===0&&w===0)||(Z=_u*c+yu*Math.abs(J),J+=Y*w+V*l-(j*p+z*f),J>=Z||-J>=Z))return J;M=l*V,g=mt*l,E=g-(g-l),C=l-E,g=mt*V,_=g-(g-V),I=V-_,L=C*I-(M-E*_-C*_-E*I),F=f*z,g=mt*f,E=g-(g-f),C=f-E,g=mt*z,_=g-(g-z),I=z-_,R=C*I-(F-E*_-C*_-E*I),O=L-R,h=L-O,Mt[0]=L-(O+h)+(h-R),y=M+O,h=y-M,b=M-(y-h)+(O-h),O=b-F,h=b-O,Mt[1]=b-(O+h)+(h-F),k=y+O,h=k-y,Mt[2]=y-(k-h)+(O-h),Mt[3]=k;const at=_n(4,ke,4,Mt,Qi);M=Y*w,g=mt*Y,E=g-(g-Y),C=Y-E,g=mt*w,_=g-(g-w),I=w-_,L=C*I-(M-E*_-C*_-E*I),F=j*p,g=mt*j,E=g-(g-j),C=j-E,g=mt*p,_=g-(g-p),I=p-_,R=C*I-(F-E*_-C*_-E*I),O=L-R,h=L-O,Mt[0]=L-(O+h)+(h-R),y=M+O,h=y-M,b=M-(y-h)+(O-h),O=b-F,h=b-O,Mt[1]=b-(O+h)+(h-F),k=y+O,h=k-y,Mt[2]=y-(k-h)+(O-h),Mt[3]=k;const dt=_n(at,Qi,4,Mt,Hi);M=l*w,g=mt*l,E=g-(g-l),C=l-E,g=mt*w,_=g-(g-w),I=w-_,L=C*I-(M-E*_-C*_-E*I),F=f*p,g=mt*f,E=g-(g-f),C=f-E,g=mt*p,_=g-(g-p),I=p-_,R=C*I-(F-E*_-C*_-E*I),O=L-R,h=L-O,Mt[0]=L-(O+h)+(h-R),y=M+O,h=y-M,b=M-(y-h)+(O-h),O=b-F,h=b-O,Mt[1]=b-(O+h)+(h-F),k=y+O,h=k-y,Mt[2]=y-(k-h)+(O-h),Mt[3]=k;const vt=_n(dt,Hi,4,Mt,Ki);return Ki[vt-1]}function wu(n,t,r,i,a,s){const c=(t-s)*(r-a),l=(n-a)*(i-s),f=c-l,p=Math.abs(c+l);return Math.abs(f)>=bu*p?f:-xu(n,t,r,i,a,s,p)}var No={};const Ke=(n,t)=>n.ll.x<=t.x&&t.x<=n.ur.x&&n.ll.y<=t.y&&t.y<=n.ur.y,Tn=(n,t)=>{if(t.ur.x<n.ll.x||n.ur.x<t.ll.x||t.ur.y<n.ll.y||n.ur.y<t.ll.y)return null;const r=n.ll.x<t.ll.x?t.ll.x:n.ll.x,i=n.ur.x<t.ur.x?n.ur.x:t.ur.x,a=n.ll.y<t.ll.y?t.ll.y:n.ll.y,s=n.ur.y<t.ur.y?n.ur.y:t.ur.y;return{ll:{x:r,y:a},ur:{x:i,y:s}}};let ce=Number.EPSILON;ce===void 0&&(ce=Math.pow(2,-52));const Su=ce*ce,to=(n,t)=>{if(-ce<n&&n<ce&&-ce<t&&t<ce)return 0;const r=n-t;return r*r<Su*n*t?0:n<t?-1:1};class Mu{constructor(){this.reset()}reset(){this.xRounder=new eo,this.yRounder=new eo}round(t,r){return{x:this.xRounder.round(t),y:this.yRounder.round(r)}}}class eo{constructor(){this.tree=new Un,this.round(0)}round(t){const r=this.tree.add(t),i=this.tree.prev(r);if(i!==null&&to(r.key,i.key)===0)return this.tree.remove(t),i.key;const a=this.tree.next(r);return a!==null&&to(r.key,a.key)===0?(this.tree.remove(t),a.key):t}}const ir=new Mu,zr=(n,t)=>n.x*t.y-n.y*t.x,Ao=(n,t)=>n.x*t.x+n.y*t.y,ro=(n,t,r)=>{const i=wu(n.x,n.y,t.x,t.y,r.x,r.y);return i>0?-1:i<0?1:0},qr=n=>Math.sqrt(Ao(n,n)),Cu=(n,t,r)=>{const i={x:t.x-n.x,y:t.y-n.y},a={x:r.x-n.x,y:r.y-n.y};return zr(a,i)/qr(a)/qr(i)},Pu=(n,t,r)=>{const i={x:t.x-n.x,y:t.y-n.y},a={x:r.x-n.x,y:r.y-n.y};return Ao(a,i)/qr(a)/qr(i)},no=(n,t,r)=>t.y===0?null:{x:n.x+t.x/t.y*(r-n.y),y:r},io=(n,t,r)=>t.x===0?null:{x:r,y:n.y+t.y/t.x*(r-n.x)},Iu=(n,t,r,i)=>{if(t.x===0)return io(r,i,n.x);if(i.x===0)return io(n,t,r.x);if(t.y===0)return no(r,i,n.y);if(i.y===0)return no(n,t,r.y);const a=zr(t,i);if(a==0)return null;const s={x:r.x-n.x,y:r.y-n.y},c=zr(s,t)/a,l=zr(s,i)/a,f=n.x+l*t.x,p=r.x+c*i.x,w=n.y+l*t.y,h=r.y+c*i.y,g=(f+p)/2,E=(w+h)/2;return{x:g,y:E}};class Ft{static compare(t,r){const i=Ft.comparePoints(t.point,r.point);return i!==0?i:(t.point!==r.point&&t.link(r),t.isLeft!==r.isLeft?t.isLeft?1:-1:fe.compare(t.segment,r.segment))}static comparePoints(t,r){return t.x<r.x?-1:t.x>r.x?1:t.y<r.y?-1:t.y>r.y?1:0}constructor(t,r){t.events===void 0?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=r}link(t){if(t.point===this.point)throw new Error("Tried to link already linked events");const r=t.point.events;for(let i=0,a=r.length;i<a;i++){const s=r[i];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}checkForConsuming(){const t=this.point.events.length;for(let r=0;r<t;r++){const i=this.point.events[r];if(i.segment.consumedBy===void 0)for(let a=r+1;a<t;a++){const s=this.point.events[a];s.consumedBy===void 0&&i.otherSE.point.events===s.otherSE.point.events&&i.segment.consume(s.segment)}}}getAvailableLinkedEvents(){const t=[];for(let r=0,i=this.point.events.length;r<i;r++){const a=this.point.events[r];a!==this&&!a.segment.ringOut&&a.segment.isInResult()&&t.push(a)}return t}getLeftmostComparator(t){const r=new Map,i=a=>{const s=a.otherSE;r.set(a,{sine:Cu(this.point,t.point,s.point),cosine:Pu(this.point,t.point,s.point)})};return(a,s)=>{r.has(a)||i(a),r.has(s)||i(s);const{sine:c,cosine:l}=r.get(a),{sine:f,cosine:p}=r.get(s);return c>=0&&f>=0?l<p?1:l>p?-1:0:c<0&&f<0?l<p?-1:l>p?1:0:f<c?-1:f>c?1:0}}}let Ou=0;class fe{static compare(t,r){const i=t.leftSE.point.x,a=r.leftSE.point.x,s=t.rightSE.point.x,c=r.rightSE.point.x;if(c<i)return 1;if(s<a)return-1;const l=t.leftSE.point.y,f=r.leftSE.point.y,p=t.rightSE.point.y,w=r.rightSE.point.y;if(i<a){if(f<l&&f<p)return 1;if(f>l&&f>p)return-1;const h=t.comparePoint(r.leftSE.point);if(h<0)return 1;if(h>0)return-1;const g=r.comparePoint(t.rightSE.point);return g!==0?g:-1}if(i>a){if(l<f&&l<w)return-1;if(l>f&&l>w)return 1;const h=r.comparePoint(t.leftSE.point);if(h!==0)return h;const g=t.comparePoint(r.rightSE.point);return g<0?1:g>0?-1:1}if(l<f)return-1;if(l>f)return 1;if(s<c){const h=r.comparePoint(t.rightSE.point);if(h!==0)return h}if(s>c){const h=t.comparePoint(r.rightSE.point);if(h<0)return 1;if(h>0)return-1}if(s!==c){const h=p-l,g=s-i,E=w-f,C=c-a;if(h>g&&E<C)return 1;if(h<g&&E>C)return-1}return s>c?1:s<c||p<w?-1:p>w?1:t.id<r.id?-1:t.id>r.id?1:0}constructor(t,r,i,a){this.id=++Ou,this.leftSE=t,t.segment=this,t.otherSE=r,this.rightSE=r,r.segment=this,r.otherSE=t,this.rings=i,this.windings=a}static fromRing(t,r,i){let a,s,c;const l=Ft.comparePoints(t,r);if(l<0)a=t,s=r,c=1;else if(l>0)a=r,s=t,c=-1;else throw new Error(`Tried to create degenerate segment at [${t.x}, ${t.y}]`);const f=new Ft(a,!0),p=new Ft(s,!1);return new fe(f,p,[i],[c])}replaceRightSE(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const t=this.leftSE.point.y,r=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<r?t:r},ur:{x:this.rightSE.point.x,y:t>r?t:r}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}comparePoint(t){if(this.isAnEndpoint(t))return 0;const r=this.leftSE.point,i=this.rightSE.point,a=this.vector();if(r.x===i.x)return t.x===r.x?0:t.x<r.x?1:-1;const s=(t.y-r.y)/a.y,c=r.x+s*a.x;if(t.x===c)return 0;const l=(t.x-r.x)/a.x,f=r.y+l*a.y;return t.y===f?0:t.y<f?-1:1}getIntersection(t){const r=this.bbox(),i=t.bbox(),a=Tn(r,i);if(a===null)return null;const s=this.leftSE.point,c=this.rightSE.point,l=t.leftSE.point,f=t.rightSE.point,p=Ke(r,l)&&this.comparePoint(l)===0,w=Ke(i,s)&&t.comparePoint(s)===0,h=Ke(r,f)&&this.comparePoint(f)===0,g=Ke(i,c)&&t.comparePoint(c)===0;if(w&&p)return g&&!h?c:!g&&h?f:null;if(w)return h&&s.x===f.x&&s.y===f.y?null:s;if(p)return g&&c.x===l.x&&c.y===l.y?null:l;if(g&&h)return null;if(g)return c;if(h)return f;const E=Iu(s,this.vector(),l,t.vector());return E===null||!Ke(a,E)?null:ir.round(E.x,E.y)}split(t){const r=[],i=t.events!==void 0,a=new Ft(t,!0),s=new Ft(t,!1),c=this.rightSE;this.replaceRightSE(s),r.push(s),r.push(a);const l=new fe(a,c,this.rings.slice(),this.windings.slice());return Ft.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),Ft.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(a.checkForConsuming(),s.checkForConsuming()),r}swapEvents(){const t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let r=0,i=this.windings.length;r<i;r++)this.windings[r]*=-1}consume(t){let r=this,i=t;for(;r.consumedBy;)r=r.consumedBy;for(;i.consumedBy;)i=i.consumedBy;const a=fe.compare(r,i);if(a!==0){if(a>0){const s=r;r=i,i=s}if(r.prev===i){const s=r;r=i,i=s}for(let s=0,c=i.rings.length;s<c;s++){const l=i.rings[s],f=i.windings[s],p=r.rings.indexOf(l);p===-1?(r.rings.push(l),r.windings.push(f)):r.windings[p]+=f}i.rings=null,i.windings=null,i.consumedBy=r,i.leftSE.consumedBy=r.leftSE,i.rightSE.consumedBy=r.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};const r=this._afterState.rings,i=this._afterState.windings,a=this._afterState.multiPolys;for(let l=0,f=this.rings.length;l<f;l++){const p=this.rings[l],w=this.windings[l],h=r.indexOf(p);h===-1?(r.push(p),i.push(w)):i[h]+=w}const s=[],c=[];for(let l=0,f=r.length;l<f;l++){if(i[l]===0)continue;const p=r[l],w=p.poly;if(c.indexOf(w)===-1)if(p.isExterior)s.push(w);else{c.indexOf(w)===-1&&c.push(w);const h=s.indexOf(p.poly);h!==-1&&s.splice(h,1)}}for(let l=0,f=s.length;l<f;l++){const p=s[l].multiPoly;a.indexOf(p)===-1&&a.push(p)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const t=this.beforeState().multiPolys,r=this.afterState().multiPolys;switch(Ut.type){case"union":{const i=t.length===0,a=r.length===0;this._isInResult=i!==a;break}case"intersection":{let i,a;t.length<r.length?(i=t.length,a=r.length):(i=r.length,a=t.length),this._isInResult=a===Ut.numMultiPolys&&i<a;break}case"xor":{const i=Math.abs(t.length-r.length);this._isInResult=i%2===1;break}case"difference":{const i=a=>a.length===1&&a[0].isSubject;this._isInResult=i(t)!==i(r);break}default:throw new Error(`Unrecognized operation type found ${Ut.type}`)}return this._isInResult}}class oo{constructor(t,r,i){if(!Array.isArray(t)||t.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=r,this.isExterior=i,this.segments=[],typeof t[0][0]!="number"||typeof t[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const a=ir.round(t[0][0],t[0][1]);this.bbox={ll:{x:a.x,y:a.y},ur:{x:a.x,y:a.y}};let s=a;for(let c=1,l=t.length;c<l;c++){if(typeof t[c][0]!="number"||typeof t[c][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let f=ir.round(t[c][0],t[c][1]);f.x===s.x&&f.y===s.y||(this.segments.push(fe.fromRing(s,f,this)),f.x<this.bbox.ll.x&&(this.bbox.ll.x=f.x),f.y<this.bbox.ll.y&&(this.bbox.ll.y=f.y),f.x>this.bbox.ur.x&&(this.bbox.ur.x=f.x),f.y>this.bbox.ur.y&&(this.bbox.ur.y=f.y),s=f)}(a.x!==s.x||a.y!==s.y)&&this.segments.push(fe.fromRing(s,a,this))}getSweepEvents(){const t=[];for(let r=0,i=this.segments.length;r<i;r++){const a=this.segments[r];t.push(a.leftSE),t.push(a.rightSE)}return t}}class Tu{constructor(t,r){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new oo(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let i=1,a=t.length;i<a;i++){const s=new oo(t[i],this,!1);s.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=s.bbox.ll.x),s.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=s.bbox.ll.y),s.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=s.bbox.ur.x),s.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=s.bbox.ur.y),this.interiorRings.push(s)}this.multiPoly=r}getSweepEvents(){const t=this.exteriorRing.getSweepEvents();for(let r=0,i=this.interiorRings.length;r<i;r++){const a=this.interiorRings[r].getSweepEvents();for(let s=0,c=a.length;s<c;s++)t.push(a[s])}return t}}class so{constructor(t,r){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof t[0][0][0]=="number"&&(t=[t])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let i=0,a=t.length;i<a;i++){const s=new Tu(t[i],this);s.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=s.bbox.ll.x),s.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=s.bbox.ll.y),s.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=s.bbox.ur.x),s.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=s.bbox.ur.y),this.polys.push(s)}this.isSubject=r}getSweepEvents(){const t=[];for(let r=0,i=this.polys.length;r<i;r++){const a=this.polys[r].getSweepEvents();for(let s=0,c=a.length;s<c;s++)t.push(a[s])}return t}}class Zr{static factory(t){const r=[];for(let i=0,a=t.length;i<a;i++){const s=t[i];if(!s.isInResult()||s.ringOut)continue;let c=null,l=s.leftSE,f=s.rightSE;const p=[l],w=l.point,h=[];for(;c=l,l=f,p.push(l),l.point!==w;)for(;;){const g=l.getAvailableLinkedEvents();if(g.length===0){const _=p[0].point,I=p[p.length-1].point;throw new Error(`Unable to complete output ring starting at [${_.x}, ${_.y}]. Last matching segment found ends at [${I.x}, ${I.y}].`)}if(g.length===1){f=g[0].otherSE;break}let E=null;for(let _=0,I=h.length;_<I;_++)if(h[_].point===l.point){E=_;break}if(E!==null){const _=h.splice(E)[0],I=p.splice(_.index);I.unshift(I[0].otherSE),r.push(new Zr(I.reverse()));continue}h.push({index:p.length,point:l.point});const C=l.getLeftmostComparator(c);f=g.sort(C)[0].otherSE;break}r.push(new Zr(p))}return r}constructor(t){this.events=t;for(let r=0,i=t.length;r<i;r++)t[r].segment.ringOut=this;this.poly=null}getGeom(){let t=this.events[0].point;const r=[t];for(let p=1,w=this.events.length-1;p<w;p++){const h=this.events[p].point,g=this.events[p+1].point;ro(h,t,g)!==0&&(r.push(h),t=h)}if(r.length===1)return null;const i=r[0],a=r[1];ro(i,t,a)===0&&r.shift(),r.push(r[0]);const s=this.isExteriorRing()?1:-1,c=this.isExteriorRing()?0:r.length-1,l=this.isExteriorRing()?r.length:-1,f=[];for(let p=c;p!=l;p+=s)f.push([r[p].x,r[p].y]);return f}isExteriorRing(){if(this._isExteriorRing===void 0){const t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let t=this.events[0];for(let a=1,s=this.events.length;a<s;a++){const c=this.events[a];Ft.compare(t,c)>0&&(t=c)}let r=t.segment.prevInResult(),i=r?r.prevInResult():null;for(;;){if(!r)return null;if(!i)return r.ringOut;if(i.ringOut!==r.ringOut)return i.ringOut.enclosingRing()!==r.ringOut?r.ringOut:r.ringOut.enclosingRing();r=i.prevInResult(),i=r?r.prevInResult():null}}}class ao{constructor(t){this.exteriorRing=t,t.poly=this,this.interiorRings=[]}addInterior(t){this.interiorRings.push(t),t.poly=this}getGeom(){const t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(let r=0,i=this.interiorRings.length;r<i;r++){const a=this.interiorRings[r].getGeom();a!==null&&t.push(a)}return t}}class Lu{constructor(t){this.rings=t,this.polys=this._composePolys(t)}getGeom(){const t=[];for(let r=0,i=this.polys.length;r<i;r++){const a=this.polys[r].getGeom();a!==null&&t.push(a)}return t}_composePolys(t){const r=[];for(let i=0,a=t.length;i<a;i++){const s=t[i];if(!s.poly)if(s.isExteriorRing())r.push(new ao(s));else{const c=s.enclosingRing();c.poly||r.push(new ao(c)),c.poly.addInterior(s)}}return r}}class Fu{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:fe.compare;this.queue=t,this.tree=new Un(r),this.segments=[]}process(t){const r=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(r),i;const a=t.isLeft?this.tree.add(r):this.tree.find(r);if(!a)throw new Error(`Unable to find segment #${r.id} [${r.leftSE.point.x}, ${r.leftSE.point.y}] -> [${r.rightSE.point.x}, ${r.rightSE.point.y}] in SweepLine tree.`);let s=a,c=a,l,f;for(;l===void 0;)s=this.tree.prev(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);for(;f===void 0;)c=this.tree.next(c),c===null?f=null:c.key.consumedBy===void 0&&(f=c.key);if(t.isLeft){let p=null;if(l){const h=l.getIntersection(r);if(h!==null&&(r.isAnEndpoint(h)||(p=h),!l.isAnEndpoint(h))){const g=this._splitSafely(l,h);for(let E=0,C=g.length;E<C;E++)i.push(g[E])}}let w=null;if(f){const h=f.getIntersection(r);if(h!==null&&(r.isAnEndpoint(h)||(w=h),!f.isAnEndpoint(h))){const g=this._splitSafely(f,h);for(let E=0,C=g.length;E<C;E++)i.push(g[E])}}if(p!==null||w!==null){let h=null;p===null?h=w:w===null?h=p:h=Ft.comparePoints(p,w)<=0?p:w,this.queue.remove(r.rightSE),i.push(r.rightSE);const g=r.split(h);for(let E=0,C=g.length;E<C;E++)i.push(g[E])}i.length>0?(this.tree.remove(r),i.push(t)):(this.segments.push(r),r.prev=l)}else{if(l&&f){const p=l.getIntersection(f);if(p!==null){if(!l.isAnEndpoint(p)){const w=this._splitSafely(l,p);for(let h=0,g=w.length;h<g;h++)i.push(w[h])}if(!f.isAnEndpoint(p)){const w=this._splitSafely(f,p);for(let h=0,g=w.length;h<g;h++)i.push(w[h])}}}this.tree.remove(r)}return i}_splitSafely(t,r){this.tree.remove(t);const i=t.rightSE;this.queue.remove(i);const a=t.split(r);return a.push(i),t.consumedBy===void 0&&this.tree.add(t),a}}const uo=typeof process<"u"&&No.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Nu=typeof process<"u"&&No.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class Au{run(t,r,i){Ut.type=t,ir.reset();const a=[new so(r,!0)];for(let h=0,g=i.length;h<g;h++)a.push(new so(i[h],!1));if(Ut.numMultiPolys=a.length,Ut.type==="difference"){const h=a[0];let g=1;for(;g<a.length;)Tn(a[g].bbox,h.bbox)!==null?g++:a.splice(g,1)}if(Ut.type==="intersection")for(let h=0,g=a.length;h<g;h++){const E=a[h];for(let C=h+1,_=a.length;C<_;C++)if(Tn(E.bbox,a[C].bbox)===null)return[]}const s=new Un(Ft.compare);for(let h=0,g=a.length;h<g;h++){const E=a[h].getSweepEvents();for(let C=0,_=E.length;C<_;C++)if(s.insert(E[C]),s.size>uo)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const c=new Fu(s);let l=s.size,f=s.pop();for(;f;){const h=f.key;if(s.size===l){const E=h.segment;throw new Error(`Unable to pop() ${h.isLeft?"left":"right"} SweepEvent [${h.point.x}, ${h.point.y}] from segment #${E.id} [${E.leftSE.point.x}, ${E.leftSE.point.y}] -> [${E.rightSE.point.x}, ${E.rightSE.point.y}] from queue.`)}if(s.size>uo)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(c.segments.length>Nu)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const g=c.process(h);for(let E=0,C=g.length;E<C;E++){const _=g[E];_.consumedBy===void 0&&s.insert(_)}l=s.size,f=s.pop()}ir.reset();const p=Zr.factory(c.segments);return new Lu(p).getGeom()}}const Ut=new Au,Ru=function(n){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return Ut.run("union",n,r)},ku=function(n){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return Ut.run("intersection",n,r)},Du=function(n){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return Ut.run("xor",n,r)},Uu=function(n){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return Ut.run("difference",n,r)};var Bu={union:Ru,intersection:ku,xor:Du,difference:Uu};function Gu(n,t){var r=Se(n),i=Se(t),a=n.properties||{},s=Bu.difference(r.coordinates,i.coordinates);return s.length===0?null:s.length===1?Ge(s[0],a):Qr(s,a)}const Ye="split_polygon",Ro=`${Ye}_passing_draw_line_string`,Bn=`${Ye}_highlight`,Yr={highlightColor:"#222",lineWidth:0,lineWidthUnit:"kilometers",onSelectFeatureRequest(){throw new Error("no Feature is selected to split.")}};let rr=Me.constants.geojsonTypes,Vu=Me.constants.events;const ze={};ze.onSetup=function(n){const{featureIds:t=[],highlightColor:r=Yr.highlightColor,lineWidth:i=Yr.lineWidth,lineWidthUnit:a=Yr.lineWidthUnit,onSelectFeatureRequest:s=Yr.onSelectFeatureRequest}=n||{},c=this._ctx.api,l=[],f=this.getSelected();if(t.length!==0)l.push.apply(l,t.map(w=>c.get(w)));else if(f.length!==0)l.push.apply(l,f.filter(w=>w.type===rr.POLYGON||w.type===rr.MULTI_POLYGON).map(w=>w.toGeoJSON()));else return s();const p={options:{highlightColor:r,lineWidth:i,lineWidthUnit:a},featuresToSplit:l,api:c};return setTimeout(this.drawAndSplit.bind(this,p),0),this.highlighFeatures(p),p};ze.drawAndSplit=function(n){const{api:t,options:r}=n,{lineWidth:i,lineWidthUnit:a}=r;try{this.changeMode(Ro,{onDraw:s=>{const c=[];n.featuresToSplit.forEach(l=>{if(Fo(l,s)){console.info(`Line was outside of Polygon ${l.id}`),c.push(l);return}else if(i===0){const f=Yu(l.geometry,s.geometry);f.id=l.id,t.add(f),c.push(f)}else{const f=ju(l.geometry,s.geometry,{line_width:i,line_width_unit:a});f.id=l.id,t.add(f),c.push(f)}}),this.fireUpdate(c),this.highlighFeatures(n,!1)},onCancel:()=>{this.highlighFeatures(n,!1)}})}catch(s){console.error(" ~ file: mode.js ~ line 116 ~ err",s)}};ze.highlighFeatures=function(n,t=!0){const r=t?n.options.highlightColor:void 0;n.featuresToSplit.forEach(i=>{n.api.setFeatureProperty(i.id,Bn,r)})};ze.toDisplayFeatures=function(n,t,r){r(t)};ze.fireUpdate=function(n){this.map.fire(Vu.UPDATE,{action:Ye,features:n})};function Yu(n,t){return La(n,t)}function ju(n,t,r){const{line_width:i,line_width_unit:a}=r||{},s=[],c=null;let l,f,p,w,h,g,E;if(typeof i>"u"||typeof a>"u"||n.type!=rr.POLYGON&&n.type!=rr.MULTI_POLYGON||t.type!=rr.LINE_STRING||Fo(t,n)||(p=Hr(n,t),p.features.length===0))return c;for(s[0]=$i(t,i,{units:a}),s[1]=$i(t,-i,{units:a}),l=0;l<=1;l++){w=l;const C=[];for(f=0;f<t.coordinates.length;f++)C.push(t.coordinates[f]);for(f=s[w].geometry.coordinates.length-1;f>=0;f--)C.push(s[w].geometry.coordinates[f]);C.push(t.coordinates[0]),h=Pt(C),g=lu(h),E=Gu(n,g)}return E}const De=`user_${Bn}`,zu=n=>n.map(t=>t.id.endsWith("inactive")?{...t,filter:[...t.filter,["!has",De]]}:t).concat([{id:`${Ye}-fill-active`,type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["has",De]],paint:{"fill-color":["get",De],"fill-outline-color":["get",De],"fill-opacity":.1}},{id:`${Ye}-stroke-active`,type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["has",De]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["get",De],"line-dasharray":[.2,2],"line-width":2}}]),{draw_point:Xu}=or.modes,{onSetup:$u,onClick:Ju,...qu}=Xu;({...qu});const{draw_line_string:Zu}=or.modes,{doubleClickZoom:Wu}=or.lib,Ln=or.constants,{onSetup:Qu,onMouseMove:Hu,...Ku}=Zu,Kr={originOnSetup:Qu,originOnMouseMove:Hu,...Ku};Kr.onSetup=function(n){const t=this.originOnSetup(),{onDraw:r,onCancel:i}=n;return t.onDraw=r,t.onCancel=i,t};Kr.onMouseMove=function(n,t){this.updateUIClasses({mouse:Ln.cursors.ADD}),this.originOnMouseMove(n,t)};Kr.onStop=function(n){const t=n.line;if(this.updateUIClasses({mouse:Ln.cursors.NONE}),Wu.enable(this),this.activateUIButton(),this.getFeature(t.id)===void 0){typeof n.onCancel=="function"&&n.onCancel();return}else t.removeCoordinate(`${n.currentVertexPosition}`);t.isValid()&&(typeof n.onDraw=="function"?n.onDraw(t.toGeoJSON()):this.map.fire("draw.passing-create",{features:[t.toGeoJSON()]})),this.deleteFeature([t.id],{silent:!0}),this.changeMode(Ln.modes.SIMPLE_SELECT,{},{silent:!0})};const{draw_polygon:tl}=Me.modes;Me.lib;Me.constants;const{onSetup:el,onMouseMove:rl,...nl}=tl;({...nl});function il(n){return{...po(n),[Ro]:Kr,[Ye]:ze}}var ol={BASE_URL:"/mapbox-gl-draw-split-polygon-mode/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{MODE:sl}=ol;let tr,Bt,ko;function lo(n){try{Bt==null||Bt.changeMode("split_polygon",{featureIds:n,highlightColor:"#222"})}catch(t){console.error(t)}}function al(){const n=Bt.getSelectedIds();n.length>0?lo(n):Bt.changeMode("select_feature",{selectHighlightColor:"yellow",onSelect(t){lo([t])}})}class ul{constructor(t){let r=this;r.draw=t.draw,r.buttons=t.buttons||[],r.onAddOrig=t.draw.onAdd,r.onRemoveOrig=t.draw.onRemove}onAdd(t){let r=this;return r.map=t,r.elContainer=r.onAddOrig(t),r.buttons.forEach(i=>{r.addButton(i)}),r.elContainer}onRemove(t){let r=this;r.buttons.forEach(i=>{r.removeButton(i)}),r.onRemoveOrig(t)}addButton(t){let r=this;var i=document.createElement("button");i.className="mapbox-gl-draw_ctrl-draw-btn",t.classes instanceof Array&&t.classes.forEach(a=>{i.classList.add(a)}),i.addEventListener(t.on,t.action),r.elContainer.appendChild(i),t.elButton=i}removeButton(t){t.elButton.removeEventListener(t.on,t.action),t.elButton.remove()}}mapboxgl.getRTLTextPluginStatus()==="unavailable"&&mapboxgl.setRTLTextPlugin("https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js",n=>{n&&console.error(n)},!0);tr=new mapboxgl.Map({container:"map",style:sl==="development"?{version:8,sources:{},layers:[]}:"https://map.ir/vector/styles/main/mapir-xyz-light-style.json",center:[51.3857,35.6102],zoom:7.78,pitch:0,interactive:!0,hash:!0,attributionControl:!0,customAttribution:" Map  Openstreetmap",transformRequest:n=>({url:n,headers:{"x-api-key":"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImp0aSI6ImRiZWU0YWU4OTk4OTA3MmQ3OTFmMjQ4ZDE5N2VhZTgwZWU2NTUyYjhlYjczOWI2NDdlY2YyYzIzNWRiYThiMzIzOTM5MDkzZDM0NTY2MmU3In0.eyJhdWQiOiI5NDMyIiwianRpIjoiZGJlZTRhZTg5OTg5MDcyZDc5MWYyNDhkMTk3ZWFlODBlZTY1NTJiOGViNzM5YjY0N2VjZjJjMjM1ZGJhOGIzMjM5MzkwOTNkMzQ1NjYyZTciLCJpYXQiOjE1OTA4MjU0NzIsIm5iZiI6MTU5MDgyNTQ3MiwiZXhwIjoxNTkzNDE3NDcyLCJzdWIiOiIiLCJzY29wZXMiOlsiYmFzaWMiXX0.M_z4xJlJRuYrh8RFe9UrW89Y_XBzpPth4yk3hlT-goBm8o3x8DGCrSqgskFfmJTUD2wC2qSoVZzQKB67sm-swtD5fkxZO7C0lBCMAU92IYZwCdYehIOtZbP5L1Lfg3C6pxd0r7gQOdzcAZj9TStnKBQPK3jSvzkiHIQhb6I0sViOS_8JceSNs9ZlVelQ3gs77xM2ksWDM6vmqIndzsS-5hUd-9qdRDTLHnhdbS4_UBwNDza47Iqd5vZkBgmQ_oDZ7dVyBuMHiQFg28V6zhtsf3fijP0UhePCj4GM89g3tzYBOmuapVBobbX395FWpnNC3bYg7zDaVHcllSUYDjGc1A","Mapir-SDK":"reactjs"}})});Bt=new MapboxDraw({modes:{...il(po(MapboxDraw.modes))},styles:[...zu(Vs(Us))],userProperties:!0});window.draw=Bt;ko=new ul({draw:Bt,buttons:[{on:"click",action:al,classes:["split-polygon"]}]});tr.once("load",()=>{tr.resize(),tr.addControl(ko,"top-right"),Bt.set({type:"FeatureCollection",features:[{id:"example",type:"Feature",properties:{},geometry:{coordinates:[[[[52,35],[53,35],[53,36],[52,36],[52,35]]],[[[50,35],[51,35],[51,36],[50,36],[50,35]],[[50.2,35.2],[50.8,35.2],[50.8,35.8],[50.2,35.8],[50.2,35.2]]]],type:"MultiPolygon"}}]}),tr.on("draw.update",function(n){console.log(" ~ file: index.js ~ line 158 ~ e",n),n.action==="split_polygon"&&Bt.getAll().features.forEach(({id:r})=>Bt.setFeatureProperty(r,Bn,void 0))})});
